<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#2A593E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Lightsprouts | Premium Seeds</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        forest: '#2A593E',        
                        leaf: '#7ED957',          
                        lime: '#D1FFBD',          
                        mint: '#F0FFE9',          
                        sand: '#fcfdfa',
                        dark: '#081C15',
                        glass: {
                            100: 'rgba(255, 255, 255, 0.1)',
                            200: 'rgba(255, 255, 255, 0.2)',
                            300: 'rgba(255, 255, 255, 0.3)',
                            400: 'rgba(255, 255, 255, 0.4)',
                            border: 'rgba(255, 255, 255, 0.4)',
                        }
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(42, 89, 62, 0.15)',
                        'glow': '0 0 20px rgba(126, 217, 87, 0.4)',
                        'nav': '0 -4px 20px rgba(0,0,0,0.05)',
                        'float': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'slide-up': 'slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'bounce-sm': 'bounceSmall 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                        'float': 'float 6s ease-in-out infinite',
                        'bloom': 'bloom 2s ease-in-out infinite',
                        'gentle-pulse': 'gentlePulse 3s ease-in-out infinite',
                        'text-glow': 'textGlow 2s ease-in-out infinite',
                        'marquee-scroll': 'marqueeScroll 40s linear infinite',
                        'marquee-scroll-reverse': 'marqueeScrollReverse 40s linear infinite',
                        'icon-spin': 'iconSpin 8s linear infinite',
                        'gradient-shift': 'gradientShift 4s ease infinite alternate',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        bounceSmall: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(0.95)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        bloom: { '0%, 100%': { transform: 'scale(1)', opacity: '0.8' }, '50%': { transform: 'scale(1.05)', opacity: '1' } },
                        gentlePulse: { '0%, 100%': { opacity: 0.6 }, '50%': { opacity: 1 } },
                        textGlow: { '0%, 100%': { 'text-shadow': '0 0 10px rgba(126, 217, 87, 0.5)' }, '50%': { 'text-shadow': '0 0 20px rgba(126, 217, 87, 0.8)' } },
                        marqueeScroll: { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } },
                        marqueeScrollReverse: { '0%': { transform: 'translateX(-50%)' }, '100%': { transform: 'translateX(0)' } },
                        iconSpin: { '0%': { transform: 'rotate(0deg)' }, '100%': { transform: 'rotate(360deg)' } },
                        gradientShift: { '0%': { 'background-position': '0% 50%' }, '100%': { 'background-position': '100% 50%' } },
                        shimmer: { '100%': { transform: 'translateX(100%)' } },
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE STYLES */
        :root {
            --safe-bottom: env(safe-area-inset-bottom);
            --safe-top: env(safe-area-inset-top);
        }
        
        body {
            background-color: #fcfdfa;
            color: #2A593E;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            /* Texture */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* GLASS MORPHISM */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(42, 89, 62, 0.05);
        }

        /* ANIMATIONS */
        .tap-active:active { transform: scale(0.96); transition: transform 0.1s; }

        /* LOADER */
        .loader-container {
            background: linear-gradient(135deg, #f0ffe9 0%, #d1ffbd 50%, #7ed957 100%);
            overflow: hidden;
        }

        .gif-container {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(126, 217, 87, 0.6), inset 0 0 40px rgba(255, 255, 255, 0.8);
            animation: bloom 2s ease-in-out infinite;
        }

        .loader-gif {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .petal {
            position: absolute;
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #7ed957, #d1ffbd);
            border-radius: 50% 0 50% 50%;
            opacity: 0.7;
            animation: float 4s ease-in-out infinite;
        }

        /* ENHANCED MARQUEE STYLES */
        .marquee-container {
            position: relative;
            overflow: hidden;
            background: linear-gradient(90deg, #2A593E 0%, #3a7a56 50%, #2A593E 100%);
            animation: gradientShift 4s ease infinite alternate;
            box-shadow: 0 4px 15px rgba(42, 89, 62, 0.2);
        }
        
        .marquee-container::before, .marquee-container::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #7ED957, transparent);
            z-index: 10;
        }
        .marquee-container::before { top: 0; }
        .marquee-container::after { bottom: 0; }

        .marquee-track {
            display: flex;
            align-items: center;
            width: max-content;
            padding: 4px 0;
        }

        .marquee-item {
            display: flex;
            align-items: center;
            margin: 0 1.5rem;
            white-space: nowrap;
        }

        .marquee-text {
            color: #ffffff;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 0.2rem 0.6rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 99px;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .marquee-primary { animation: marquee-scroll 35s linear infinite; }
        .marquee-secondary { animation: marquee-scroll-reverse 40s linear infinite; }

        .marquee-track:hover { animation-play-state: paused; }

        /* MODAL & DRAWER TRANSITIONS */
        .modal-enter {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal-enter.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-enter .sheet-content {
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .modal-enter.active .sheet-content {
            transform: translateY(0);
        }
        
        /* Mobile Nav */
        .bottom-nav { 
            padding-bottom: calc(10px + var(--safe-bottom)); 
            padding-top: 10px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.05);
        }

        /* Skeleton Shimmer */
        .skeleton {
            background: #f0f0f0;
            position: relative;
            overflow: hidden;
        }
        .skeleton::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 100%);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }

        ::selection { background: #D1FFBD; color: #2A593E; }
    </style>
</head>
<body class="font-sans antialiased min-h-screen relative flex flex-col pb-24 md:pb-0">

    <!-- LOADER -->
    <div id="loader" class="fixed inset-0 z-[100] loader-container flex flex-col items-center justify-center transition-opacity duration-1000">
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="petal" style="top: 20%; left: 15%; animation-delay: 0s;"></div>
            <div class="petal" style="top: 60%; right: 20%; animation-delay: 1s;"></div>
            <div class="petal" style="bottom: 15%; left: 30%; animation-delay: 2s;"></div>
        </div>
        
        <div class="relative mb-8">
            <div class="gif-container">
                <img src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExd3Q1NnZyN21kMm1yNTJ2aGdwdDltcmlxamtqNDYxMzZmM2xrYngzZSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/B2bZ5FhOnTRvvkOIZn/giphy.gif" alt="Loading..." class="loader-gif">
            </div>
            <div class="absolute inset-0 -z-10 bg-white/40 rounded-full blur-3xl animate-gentle-pulse"></div>
        </div>
        
        <h1 class="text-4xl md:text-5xl font-serif font-bold text-forest mb-2 animate-text-glow text-center">
            lightsprouts<span class="text-leaf">.</span>
        </h1>
        <p class="text-forest/80 font-medium tracking-wider text-xs md:text-sm uppercase">Growing Your Green Dreams</p>
    </div>

    <!-- APP HEADER -->
    <header class="fixed top-0 left-0 w-full z-40 transition-all duration-300 shadow-nav bg-white/80 backdrop-blur-xl">
        
        <!-- ENHANCED MARQUEE -->
        <div class="marquee-container z-50">
            <!-- Primary Track -->
            <div class="marquee-track marquee-primary">
                <div class="marquee-item"><i data-lucide="sprout" class="w-3 h-3 text-lime mr-2 animate-spin-slow"></i><span class="marquee-text">Premium Organic Seeds</span></div>
                <div class="marquee-item"><i data-lucide="check-circle" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">95% Germination Guarantee</span></div>
                <div class="marquee-item"><i data-lucide="truck" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">Free Shipping ₹500+</span></div>
                <div class="marquee-item"><i data-lucide="shield" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">Certified Organic</span></div>
                <!-- Duplicate -->
                <div class="marquee-item"><i data-lucide="sprout" class="w-3 h-3 text-lime mr-2 animate-spin-slow"></i><span class="marquee-text">Premium Organic Seeds</span></div>
                <div class="marquee-item"><i data-lucide="check-circle" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">95% Germination Guarantee</span></div>
                <div class="marquee-item"><i data-lucide="truck" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">Free Shipping ₹500+</span></div>
                <div class="marquee-item"><i data-lucide="shield" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">Certified Organic</span></div>
            </div>
        </div>

        <!-- Main Nav Bar -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-14 md:h-16 flex justify-between items-center relative">
            
            <!-- Logo -->
            <a href="#" onclick="window.scrollTo(0,0); playSound('click'); return false;" class="text-xl md:text-2xl font-serif font-bold text-forest flex items-center gap-1 tap-active select-none">
                <div class="w-8 h-8 rounded-full bg-forest flex items-center justify-center text-lime shadow-lg">
                    <i data-lucide="sprout" class="w-5 h-5 fill-current"></i>
                </div>
                lightsprouts
            </a>

            <!-- Desktop Menu -->
            <nav class="hidden md:flex items-center gap-1 bg-gray-100/50 p-1 rounded-full border border-gray-200">
                <button onclick="filterProducts('all')" class="nav-pill px-5 py-1.5 rounded-full text-sm font-bold transition-all bg-white text-forest shadow-sm border border-gray-100">All</button>
                <button onclick="filterProducts('fruit-seeds')" class="nav-pill px-5 py-1.5 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white/50">Fruits</button>
                <button onclick="filterProducts('vegetable-seeds')" class="nav-pill px-5 py-1.5 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white/50">Veg</button>
                <button onclick="filterProducts('plant-seeds')" class="nav-pill px-5 py-1.5 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white/50">Plants</button>
            </nav>

            <!-- Actions -->
            <div class="flex items-center gap-2 md:gap-3">
                <!-- Sound Toggle -->
                <button onclick="toggleSound()" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-forest/5 text-forest transition-colors tap-active hidden md:flex" title="Toggle Sound">
                    <i id="sound-icon-desktop" data-lucide="volume-2" class="w-5 h-5"></i>
                </button>

                <button onclick="openSearch()" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-forest/5 text-forest transition-colors tap-active hidden md:flex">
                    <i data-lucide="search" class="w-5 h-5"></i>
                </button>
                
                <button onclick="toggleWishlist()" class="relative w-9 h-9 flex items-center justify-center rounded-full hover:bg-forest/5 text-forest transition-colors tap-active hidden md:flex">
                    <i data-lucide="heart" class="w-5 h-5"></i>
                    <span id="wishlist-badge-desktop" class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full opacity-0 transition-opacity border border-white"></span>
                </button>

                <button onclick="openCart()" class="relative w-9 h-9 md:w-10 md:h-10 flex items-center justify-center rounded-full bg-forest text-white shadow-glow hover:bg-forest/90 transition-all tap-active group">
                    <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                    <span id="cart-badge" class="absolute -top-1 -right-1 bg-leaf text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center opacity-0 scale-0 transition-all duration-300 border border-white shadow-sm">0</span>
                </button>
            </div>
        </div>

        <!-- Sticky Mobile Categories -->
        <div class="md:hidden w-full bg-white/95 backdrop-blur-xl border-b border-gray-100 py-2 px-4 overflow-x-auto no-scrollbar flex gap-2 snap-x shadow-sm">
            <button onclick="filterProducts('all')" class="cat-pill snap-start whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-bold bg-forest text-white shadow-sm transition-all border border-transparent">All Seeds</button>
            <button onclick="filterProducts('fruit-seeds')" class="cat-pill snap-start whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-bold bg-white text-forest border border-gray-200 transition-all">Fruits</button>
            <button onclick="filterProducts('vegetable-seeds')" class="cat-pill snap-start whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-bold bg-white text-forest border border-gray-200 transition-all">Vegetables</button>
            <button onclick="filterProducts('plant-seeds')" class="cat-pill snap-start whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-bold bg-white text-forest border border-gray-200 transition-all">Herbs</button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow pt-[8.5rem] md:pt-36 px-4 sm:px-6 w-full max-w-7xl mx-auto z-10 relative">
        
        <!-- Hero Section -->
        <section class="relative w-full h-[50vh] md:h-[450px] rounded-[2rem] overflow-hidden mb-8 shadow-float group">
            <img id="hero-img" src="https://images.unsplash.com/photo-1530836369250-ef72a3f5cda8?q=80&w=2070&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover transition-transform duration-[3s] group-hover:scale-105">
            <div class="absolute inset-0 bg-gradient-to-t from-dark/80 via-dark/20 to-transparent"></div>
            
            <div class="absolute bottom-0 left-0 w-full p-6 md:p-12 flex flex-col items-start text-white">
                <div class="flex items-center gap-2 mb-3 animate-fade-in">
                    <span class="px-3 py-1 rounded-full bg-white/20 backdrop-blur-md border border-white/20 text-[10px] font-bold uppercase tracking-wider">New Arrival</span>
                    <span class="w-1.5 h-1.5 rounded-full bg-leaf animate-pulse"></span>
                </div>
                <h1 class="text-4xl md:text-6xl font-serif font-bold mb-3 leading-tight animate-fade-in" style="animation-delay: 0.1s">
                    Grow your <br><span class="text-lime italic">sanctuary.</span>
                </h1>
                <p class="max-w-md mb-6 text-sm opacity-90 leading-relaxed animate-fade-in hidden md:block" style="animation-delay: 0.2s">
                    Premium organic seeds sourced from sustainable farms. 95% germination guarantee.
                </p>
                <button onclick="scrollToGrid()" class="bg-leaf text-forest font-bold py-3 px-6 rounded-xl hover:bg-lime transition-all flex items-center gap-2 shadow-glow tap-active animate-fade-in group/btn text-sm md:text-base" style="animation-delay: 0.3s">
                    Start Growing <i data-lucide="arrow-down" class="w-4 h-4 group-hover/btn:translate-y-1 transition-transform"></i>
                </button>
            </div>
        </section>

        <!-- Stats Bar -->
        <div class="grid grid-cols-3 gap-2 mb-8 bg-white/60 p-4 rounded-2xl border border-white/50 shadow-sm backdrop-blur-sm animate-fade-in">
            <div class="text-center">
                <p class="text-xl md:text-2xl font-serif font-bold text-forest">95%</p>
                <p class="text-[9px] md:text-[10px] font-bold text-gray-400 uppercase tracking-wider">Germination</p>
            </div>
            <div class="text-center border-l border-gray-200">
                <p class="text-xl md:text-2xl font-serif font-bold text-forest">100%</p>
                <p class="text-[9px] md:text-[10px] font-bold text-gray-400 uppercase tracking-wider">Organic</p>
            </div>
            <div class="text-center border-l border-gray-200">
                <p class="text-xl md:text-2xl font-serif font-bold text-forest">24/7</p>
                <p class="text-[9px] md:text-[10px] font-bold text-gray-400 uppercase tracking-wider">Support</p>
            </div>
        </div>

        <!-- Product Grid Header -->
        <div id="grid-anchor" class="flex items-end justify-between mb-4 px-1">
            <div>
                <h2 class="text-xl md:text-2xl font-serif font-bold text-forest flex items-center gap-2">
                    Curated Seeds
                    <span id="item-count-badge" class="bg-forest/10 text-forest text-[10px] px-2 py-0.5 rounded-full font-sans font-bold align-middle">8</span>
                </h2>
            </div>
            <button class="text-forest/60 hover:text-forest text-xs font-bold uppercase tracking-wider flex items-center gap-1 bg-white px-3 py-1 rounded-full shadow-sm border border-gray-100">
                Sort <i data-lucide="chevron-down" class="w-3 h-3"></i>
            </button>
        </div>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6 mb-24">
            <!-- Loading Skeletons -->
            <div class="rounded-2xl overflow-hidden aspect-[4/5] skeleton"></div>
            <div class="rounded-2xl overflow-hidden aspect-[4/5] skeleton"></div>
            <div class="rounded-2xl overflow-hidden aspect-[4/5] skeleton"></div>
            <div class="rounded-2xl overflow-hidden aspect-[4/5] skeleton"></div>
        </div>

    </main>

    <!-- MOBILE BOTTOM NAVIGATION -->
    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur-xl border-t border-gray-200 z-40 bottom-nav flex justify-around items-center pt-3 pb-1">
        <button onclick="switchTab('home')" class="nav-item active flex flex-col items-center gap-1 text-forest w-16 tap-active transition-colors">
            <i data-lucide="home" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">Home</span>
        </button>
        <button onclick="openSearch()" class="nav-item flex flex-col items-center gap-1 text-gray-400 hover:text-forest w-16 tap-active transition-colors">
            <i data-lucide="search" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">Search</span>
        </button>
        <button onclick="toggleWishlist()" class="nav-item flex flex-col items-center gap-1 text-gray-400 hover:text-forest w-16 tap-active relative transition-colors">
            <i data-lucide="heart" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">Saved</span>
            <span id="wishlist-badge-mobile" class="absolute top-0 right-3.5 w-2 h-2 bg-red-500 rounded-full opacity-0 ring-2 ring-white"></span>
        </button>
        <button onclick="toggleSound()" class="nav-item flex flex-col items-center gap-1 text-gray-400 hover:text-forest w-16 tap-active transition-colors">
             <i id="sound-icon-mobile" data-lucide="volume-2" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">Sound</span>
        </button>
    </nav>

    <!-- PRODUCT DETAIL SHEET/MODAL -->
    <div id="product-modal" class="fixed inset-0 z-50 flex items-end md:items-center justify-center pointer-events-none modal-enter">
        <div class="absolute inset-0 bg-dark/40 backdrop-blur-sm transition-opacity" onclick="closeModal('product-modal')"></div>
        
        <div class="sheet-content pointer-events-auto bg-[#FAFAF9] w-full md:w-[900px] md:h-[600px] rounded-t-[2rem] md:rounded-[2.5rem] shadow-2xl flex flex-col md:flex-row overflow-hidden relative max-h-[92vh] md:max-h-[85vh]">
            
            <div class="md:hidden absolute top-3 left-1/2 -translate-x-1/2 w-12 h-1.5 bg-gray-300 rounded-full z-20"></div>
            
            <button onclick="closeModal('product-modal')" class="absolute top-4 right-4 z-20 bg-white/80 p-2 rounded-full hover:bg-forest hover:text-white transition-colors text-forest backdrop-blur-sm tap-active shadow-sm border border-gray-100">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>

            <!-- Image Side -->
            <div class="w-full md:w-1/2 h-72 md:h-full bg-gray-100 relative group">
                <img id="modal-img" src="" class="w-full h-full object-cover">
                <div class="absolute bottom-4 left-4 right-4 flex gap-2">
                    <span id="modal-tag" class="glass-card px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wide text-forest backdrop-blur-md border-white/40">Organic</span>
                </div>
            </div>

            <!-- Content Side -->
            <div class="w-full md:w-1/2 p-6 md:p-10 flex flex-col overflow-y-auto pb-24 md:pb-10 bg-gradient-to-b from-white to-mint/20">
                <div class="mb-2 flex items-center gap-2 opacity-60">
                    <span id="modal-cat" class="text-xs font-bold uppercase tracking-widest text-forest">Category</span>
                    <span class="w-1 h-1 bg-forest rounded-full"></span>
                    <div class="flex items-center text-yellow-500">
                        <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                        <span class="text-xs text-forest ml-1 font-bold" id="modal-rating-text">4.8</span>
                    </div>
                </div>
                
                <h2 id="modal-title" class="text-3xl md:text-4xl font-serif font-bold text-forest mb-2 leading-tight">Product Name</h2>
                
                <div class="flex items-baseline gap-3 mb-6">
                    <span id="modal-price" class="text-2xl font-bold text-leaf">₹0.00</span>
                    <span id="modal-original-price" class="text-gray-400 text-sm line-through decoration-red-400">₹0.00</span>
                </div>

                <p id="modal-desc" class="text-forest/70 text-sm leading-relaxed mb-8 font-medium">
                    Description goes here...
                </p>

                <!-- Info Grid -->
                <div class="grid grid-cols-2 gap-3 mb-8">
                    <div class="bg-white p-3 rounded-2xl border border-gray-100 shadow-sm flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-500">
                            <i data-lucide="sun" class="w-4 h-4"></i>
                        </div>
                        <div>
                            <span class="block text-[10px] font-bold text-gray-400 uppercase">Season</span>
                            <span id="modal-season" class="text-xs font-bold text-forest">All Year</span>
                        </div>
                    </div>
                    <div class="bg-white p-3 rounded-2xl border border-gray-100 shadow-sm flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-500">
                            <i data-lucide="clock" class="w-4 h-4"></i>
                        </div>
                        <div>
                            <span class="block text-[10px] font-bold text-gray-400 uppercase">Harvest</span>
                            <span id="modal-harvest" class="text-xs font-bold text-forest">60 Days</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="mt-auto pt-4 border-t border-forest/5">
                    <div class="flex items-center gap-3">
                        <!-- Qty -->
                        <div class="flex items-center bg-white border border-gray-200 rounded-xl px-1 h-12 shadow-sm shrink-0">
                            <button onclick="adjustQty(-1)" class="w-10 h-full flex items-center justify-center text-forest/60 hover:text-forest active:scale-90"><i data-lucide="minus" class="w-4 h-4"></i></button>
                            <span id="qty-display" class="w-6 text-center font-bold text-forest text-sm">1</span>
                            <button onclick="adjustQty(1)" class="w-10 h-full flex items-center justify-center text-forest/60 hover:text-forest active:scale-90"><i data-lucide="plus" class="w-4 h-4"></i></button>
                        </div>
                        
                        <!-- Main Action -->
                        <button onclick="addToCart()" class="flex-grow h-12 bg-forest text-white font-bold rounded-xl shadow-lg shadow-forest/20 tap-active flex items-center justify-center gap-2 hover:bg-[#1e3f2d] transition-colors">
                            Add <span id="add-price" class="text-xs font-normal opacity-70"></span>
                        </button>

                        <button onclick="toggleWishlistItem(currentItem.id)" id="modal-heart-btn" class="h-12 w-12 shrink-0 rounded-xl border border-gray-200 bg-white flex items-center justify-center text-forest hover:bg-red-50 hover:text-red-500 hover:border-red-200 transition-colors tap-active shadow-sm">
                            <i data-lucide="heart" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CART DRAWER -->
    <div id="cart-drawer" class="fixed inset-0 z-[60] flex justify-end pointer-events-none modal-enter">
        <div class="absolute inset-0 bg-dark/20 backdrop-blur-sm transition-opacity" onclick="closeModal('cart-drawer')"></div>
        <div class="sheet-content bg-[#FAFAF9] w-full max-w-md h-full shadow-2xl pointer-events-auto flex flex-col translate-x-full" style="transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);">
            
            <div class="p-6 flex justify-between items-center bg-white border-b border-gray-100 sticky top-0 z-10">
                <h3 class="text-xl font-serif font-bold text-forest flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-mint flex items-center justify-center text-leaf">
                        <i data-lucide="shopping-bag" class="w-4 h-4"></i>
                    </div>
                    My Basket
                </h3>
                <button onclick="closeModal('cart-drawer')" class="p-2 rounded-full hover:bg-gray-100 text-forest/60 transition-colors tap-active">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div id="cart-items-container" class="flex-grow overflow-y-auto p-4 space-y-3 bg-gray-50/50">
                <!-- Items injected here -->
            </div>

            <div class="p-6 bg-white border-t border-gray-100 mt-auto shadow-[0_-4px_20px_rgba(0,0,0,0.03)] pb-8 md:pb-6">
                <div class="flex justify-between items-baseline mb-4">
                    <span class="text-gray-500 text-sm font-medium">Total Estimate</span>
                    <span id="cart-total-price" class="text-2xl font-bold text-forest">₹0.00</span>
                </div>
                <button onclick="initCheckout()" class="w-full bg-leaf text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-leaf/20 tap-active hover:bg-[#6ec248] transition-colors">
                    Checkout on WhatsApp
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed top-24 right-4 md:right-8 z-[80] bg-white/90 backdrop-blur-md border border-gray-200 shadow-float rounded-2xl p-4 flex items-center gap-3 translate-x-[150%] transition-transform duration-500 max-w-[90vw] w-auto">
        <div class="w-8 h-8 rounded-full bg-leaf text-white flex items-center justify-center shrink-0 shadow-sm">
            <i data-lucide="check" class="w-4 h-4"></i>
        </div>
        <div>
            <h4 class="font-bold text-forest text-sm" id="toast-title">Success</h4>
            <p class="text-xs text-gray-500" id="toast-message">Action completed.</p>
        </div>
    </div>

    <!-- CHECKOUT FORM MODAL -->
    <div id="checkout-modal" class="fixed inset-0 z-[80] flex items-center justify-center p-4 pointer-events-none modal-enter">
        <div class="absolute inset-0 bg-forest/80 backdrop-blur-md transition-opacity" onclick="closeModal('checkout-modal')"></div>
        <div class="sheet-content pointer-events-auto bg-white rounded-3xl w-full max-w-md p-8 relative shadow-2xl scale-95 opacity-0 transition-all duration-300 transform-gpu">
            
            <button onclick="closeModal('checkout-modal')" class="absolute top-4 right-4 p-2 text-gray-400 hover:text-forest transition-colors tap-active">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>

            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-mint rounded-full flex items-center justify-center mx-auto mb-4 text-leaf animate-bounce-sm">
                    <i data-lucide="truck" class="w-8 h-8"></i>
                </div>
                <h3 class="text-2xl font-serif font-bold text-forest">Delivery Details</h3>
                <p class="text-gray-400 text-sm mt-2">Enter details to generate WhatsApp order.</p>
            </div>

            <form onsubmit="processOrder(event)" class="space-y-4">
                <input type="text" id="c-name" required placeholder="Full Name" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3.5 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400">
                <input type="tel" id="c-phone" required placeholder="Phone Number" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3.5 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400">
                <textarea id="c-address" required rows="3" placeholder="Delivery Address" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3.5 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all resize-none placeholder:text-gray-400"></textarea>
                
                <button type="submit" class="w-full bg-forest text-white font-bold py-4 rounded-xl mt-4 shadow-xl tap-active hover:bg-[#1e3f2d] transition-colors">
                    Confirm Order
                </button>
            </form>
        </div>
    </div>

    <!-- SEARCH MODAL -->
    <div id="search-modal" class="fixed inset-0 z-50 bg-white/95 backdrop-blur-xl modal-enter flex flex-col">
        <div class="pt-12 px-4 pb-4 border-b border-gray-100 flex items-center gap-3">
            <i data-lucide="search" class="text-gray-400 w-5 h-5"></i>
            <input type="text" id="search-input" placeholder="Search for seeds..." class="flex-grow bg-transparent text-lg font-medium text-forest placeholder:text-gray-300 focus:outline-none" oninput="handleSearch(this.value)">
            <button onclick="closeModal('search-modal')" class="text-sm font-bold text-gray-400 bg-gray-100 px-3 py-1 rounded-full">Cancel</button>
        </div>
        <div id="search-results" class="flex-grow overflow-y-auto p-4 grid grid-cols-2 gap-3 content-start">
            <!-- Results -->
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // --- DATA ---
        const products = [
            { id: 1, type: 'fruit-seeds', name: "Heirloom Tomato", price: 120, originalPrice: 150, img: "https://images.unsplash.com/photo-1592841200221-a6898f307baa?q=80&w=600&auto=format&fit=crop", desc: "Juicy, rich-flavored tomatoes perfect for salads and sauces.", germ: "98%", time: "60 Days", rating: 4.8 },
            { id: 2, type: 'vegetable-seeds', name: "Spicy Chilli", price: 80, originalPrice: 95, img: "https://images.unsplash.com/photo-1588252303782-cb80119abd6d?q=80&w=600&auto=format&fit=crop", desc: "High heat variety, excellent for adding kick to your dishes.", germ: "95%", time: "75 Days", rating: 4.6 },
            { id: 3, type: 'plant-seeds', name: "Fresh Coriander", price: 45, originalPrice: null, img: "https://images.unsplash.com/photo-1596043225276-2afc36c2d0b9?q=80&w=600&auto=format&fit=crop", desc: "Aromatic herb essential for garnishing and cooking.", germ: "90%", time: "35 Days", rating: 4.5 },
            { id: 4, type: 'fruit-seeds', name: "Sweet Strawberry", price: 180, originalPrice: 220, img: "https://images.unsplash.com/photo-1543528176-61b239494933?q=80&w=600&auto=format&fit=crop", desc: "Red, sweet berries that grow well in pots or ground.", germ: "85%", time: "90 Days", rating: 4.9 },
            { id: 5, type: 'vegetable-seeds', name: "Crunchy Carrot", price: 95, originalPrice: 110, img: "https://images.unsplash.com/photo-1598170845058-78131a90f4a6?q=80&w=600&auto=format&fit=crop", desc: "Vitamin-rich roots with a satisfying crunch.", germ: "92%", time: "70 Days", rating: 4.7 },
            { id: 6, type: 'plant-seeds', name: "Holy Basil", price: 60, originalPrice: null, img: "https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=600&auto=format&fit=crop", desc: "Sacred medicinal plant known for immunity boosting.", germ: "88%", time: "45 Days", rating: 4.8 },
            { id: 7, type: 'fruit-seeds', name: "Watermelon", price: 110, originalPrice: 140, img: "https://images.unsplash.com/photo-1589596660126-e75c5e317c2f?q=80&w=600&auto=format&fit=crop", desc: "Summer favorite, grows large and sweet.", germ: "85%", time: "85 Days", rating: 4.5 },
            { id: 8, type: 'vegetable-seeds', name: "Spinach", price: 55, originalPrice: 70, img: "https://images.unsplash.com/photo-1576045057995-568f588f82fb?q=80&w=600&auto=format&fit=crop", desc: "Iron-packed leafy green, grows quickly.", germ: "95%", time: "40 Days", rating: 4.4 },
        ];

        // --- STATE ---
        let state = {
            cart: JSON.parse(localStorage.getItem('ls_cart')) || [],
            wishlist: JSON.parse(localStorage.getItem('ls_wishlist')) || [],
            soundEnabled: JSON.parse(localStorage.getItem('ls_sound')) !== false,
            currentItem: null,
            tempQty: 1
        };

        // --- SOUND ENGINE ---
        const soundEffects = {
            click: () => {
                if (!state.soundEnabled) return;
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.value = 800;
                    gain.gain.setValueAtTime(0.05, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.1);
                } catch(e){}
            },
            success: () => {
                if (!state.soundEnabled) return;
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.setValueAtTime(523.25, ctx.currentTime);
                    osc.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.05, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.3);
                } catch(e){}
            }
        };

        function playSound(type) {
            if(soundEffects[type]) soundEffects[type]();
        }

        function toggleSound() {
            state.soundEnabled = !state.soundEnabled;
            localStorage.setItem('ls_sound', JSON.stringify(state.soundEnabled));
            updateSoundIcons();
            showToast(state.soundEnabled ? 'Sound On' : 'Sound Off', 'Audio effects updated');
        }

        function updateSoundIcons() {
            const iconD = document.getElementById('sound-icon-desktop');
            const iconM = document.getElementById('sound-icon-mobile');
            const iconName = state.soundEnabled ? 'volume-2' : 'volume-x';
            
            if(iconD) {
                iconD.setAttribute('data-lucide', iconName);
                if(!state.soundEnabled) iconD.classList.add('text-gray-400');
                else iconD.classList.remove('text-gray-400');
            }
            if(iconM) {
                iconM.setAttribute('data-lucide', iconName);
            }
            lucide.createIcons();
        }

        // --- INIT ---
        window.addEventListener('load', () => {
            // GIF Preloader logic
            const gif = new Image();
            gif.src = "https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExd3Q1NnZyN21kMm1yNTJ2aGdwdDltcmlxamtqNDYxMzZmM2xrYngzZSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/B2bZ5FhOnTRvvkOIZn/giphy.gif";

            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => document.getElementById('loader').remove(), 1000);
            }, 2500);
            
            setTimeout(() => {
                renderGrid('all');
            }, 500);

            updateBadges();
            updateSoundIcons();
            
            // Marquee Hover Pause
            document.querySelectorAll('.marquee-track').forEach(track => {
                track.addEventListener('mouseenter', () => track.style.animationPlayState = 'paused');
                track.addEventListener('mouseleave', () => track.style.animationPlayState = 'running');
            });

            lucide.createIcons();
        });

        // --- RENDER FUNCTIONS ---
        function renderGrid(filter) {
            const grid = document.getElementById('product-grid');
            const data = filter === 'all' ? products : products.filter(p => p.type === filter);
            
            // Update counts
            const countBadge = document.getElementById('item-count-badge');
            if(countBadge) countBadge.innerText = data.length;

            // Update active state of pills
            document.querySelectorAll('.cat-pill, .nav-pill').forEach(btn => {
                const btnText = btn.textContent.toLowerCase();
                const isActive = (filter === 'all' && btnText.includes('all')) || 
                               (filter !== 'all' && btnText.includes(filter.replace('-seeds', '').replace('vegetable', 'veg')));
                
                if(isActive) {
                    btn.classList.add('bg-forest', 'text-white', 'border-forest', 'shadow-sm');
                    btn.classList.remove('bg-white', 'text-forest', 'text-gray-500');
                } else {
                    btn.classList.remove('bg-forest', 'text-white', 'border-forest', 'shadow-sm');
                    if(btn.classList.contains('nav-pill')) {
                        btn.classList.add('text-gray-500');
                    } else {
                        btn.classList.add('bg-white', 'text-forest');
                    }
                }
            });

            grid.innerHTML = data.map((p, idx) => `
                <div class="group bg-white rounded-2xl p-2 md:p-3 border border-transparent hover:border-leaf/30 shadow-sm hover:shadow-soft transition-all duration-300 cursor-pointer animate-slide-up" 
                     style="animation-delay: ${idx * 0.05}s"
                     onclick="openProduct(${p.id})">
                    <div class="aspect-[4/5] rounded-xl overflow-hidden relative bg-gray-100 mb-3">
                        <img src="${p.img}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                        ${p.originalPrice ? `<div class="absolute top-2 left-2 bg-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded shadow-sm">- ${(100 - (p.price/p.originalPrice)*100).toFixed(0)}%</div>` : ''}
                        <button onclick="event.stopPropagation(); toggleWishlistItem(${p.id})" class="absolute top-2 right-2 w-7 h-7 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center text-forest hover:bg-white transition-all tap-active hover:scale-110 shadow-sm">
                            <i data-lucide="heart" class="w-3.5 h-3.5 ${state.wishlist.includes(p.id) ? 'fill-red-500 text-red-500' : ''}"></i>
                        </button>
                        
                        <div class="absolute bottom-2 right-2 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300 hidden md:block">
                             <button class="w-8 h-8 rounded-full bg-white text-forest shadow-md flex items-center justify-center hover:bg-leaf hover:text-white transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                             </button>
                        </div>
                    </div>
                    <div class="px-1">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-forest text-sm md:text-base leading-tight line-clamp-1 group-hover:text-leaf transition-colors">${p.name}</h3>
                            <div class="flex items-center gap-0.5 text-[10px] font-bold text-yellow-500 bg-yellow-50 px-1 rounded">
                                <i data-lucide="star" class="w-2.5 h-2.5 fill-current"></i> ${p.rating}
                            </div>
                        </div>
                        <p class="text-[9px] md:text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-2">${p.type.replace('-', ' ')}</p>
                        <div class="flex items-baseline gap-2">
                            <span class="text-base md:text-lg font-bold text-forest">₹${p.price}</span>
                            ${p.originalPrice ? `<span class="text-[10px] text-gray-400 line-through">₹${p.originalPrice}</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // --- ACTIONS ---
        function openProduct(id) {
            playSound('click');
            const p = products.find(x => x.id === id);
            if(!p) return;

            state.currentItem = p;
            state.tempQty = 1;

            document.getElementById('modal-img').src = p.img;
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-price').innerText = `₹${p.price}`;
            document.getElementById('add-price').innerText = `(₹${p.price})`;
            document.getElementById('modal-desc').innerText = p.desc;
            document.getElementById('modal-harvest').innerText = p.time;
            document.getElementById('qty-display').innerText = "1";
            document.getElementById('modal-rating-text').innerText = p.rating;
            
            // Heart state
            const heartBtn = document.getElementById('modal-heart-btn');
            if(state.wishlist.includes(p.id)) {
                heartBtn.innerHTML = `<i data-lucide="heart" class="w-5 h-5 fill-red-500 text-red-500"></i>`;
                heartBtn.classList.add('bg-red-50', 'border-red-200');
            } else {
                heartBtn.innerHTML = `<i data-lucide="heart" class="w-5 h-5"></i>`;
                heartBtn.classList.remove('bg-red-50', 'border-red-200');
            }

            if(p.originalPrice) {
                document.getElementById('modal-original-price').innerText = `₹${p.originalPrice}`;
                document.getElementById('modal-original-price').classList.remove('hidden');
            } else {
                document.getElementById('modal-original-price').classList.add('hidden');
            }

            const modal = document.getElementById('product-modal');
            modal.classList.add('active');
            lucide.createIcons();
        }

        function closeModal(id) {
            playSound('click');
            const modal = document.getElementById(id);
            modal.classList.remove('active');
            
            const sheet = modal.querySelector('.sheet-content');
            if(sheet && id === 'cart-drawer') {
                sheet.style.transform = 'translateX(100%)';
            }
        }

        function adjustQty(delta) {
            if(state.tempQty + delta >= 1) {
                state.tempQty += delta;
                document.getElementById('qty-display').innerText = state.tempQty;
                document.getElementById('add-price').innerText = `(₹${state.tempQty * state.currentItem.price})`;
                playSound('click');
            }
        }

        function addToCart() {
            if(!state.currentItem) return;
            
            const existing = state.cart.find(i => i.id === state.currentItem.id);
            if(existing) {
                existing.qty += state.tempQty;
            } else {
                state.cart.push({...state.currentItem, qty: state.tempQty});
            }
            
            saveState();
            closeModal('product-modal');
            showToast('Added', `${state.tempQty}x ${state.currentItem.name}`);
            playSound('success');
        }

        function toggleWishlistItem(id) {
            playSound('click');
            const idx = state.wishlist.indexOf(id);
            if(idx > -1) {
                state.wishlist.splice(idx, 1);
                showToast('Removed', 'Item removed from favorites');
            } else {
                state.wishlist.push(id);
                showToast('Saved', 'Item saved to favorites');
                playSound('success');
            }
            saveState();
            
            if(document.getElementById('product-modal').classList.contains('active')) {
                openProduct(id);
            }
            // Update grid without full re-render if possible, or simple re-render
            // For simplicity, re-render currently active view
            const activePill = document.querySelector('.cat-pill.bg-forest');
            const filter = activePill ? activePill.textContent.toLowerCase().includes('all') ? 'all' : 
                          (activePill.textContent.includes('Fruit') ? 'fruit-seeds' : 
                          (activePill.textContent.includes('Veg') ? 'vegetable-seeds' : 'plant-seeds')) : 'all';
            renderGrid(filter);
        }

        function openCart() {
            playSound('click');
            const drawer = document.getElementById('cart-drawer');
            const container = document.getElementById('cart-items-container');
            const sheet = drawer.querySelector('.sheet-content');
            
            drawer.classList.add('active');
            setTimeout(() => {
                sheet.style.transform = 'translateX(0)';
            }, 10);

            if(state.cart.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-gray-400">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-300">
                            <i data-lucide="shopping-bag" class="w-8 h-8"></i>
                        </div>
                        <p class="font-bold text-gray-500">Your basket is empty</p>
                        <p class="text-xs mt-1 text-gray-400">Time to add some green friends!</p>
                    </div>
                `;
                document.getElementById('cart-total-price').innerText = '₹0.00';
            } else {
                let total = 0;
                container.innerHTML = state.cart.map((item, idx) => {
                    total += item.price * item.qty;
                    return `
                        <div class="flex gap-3 bg-white p-3 rounded-2xl border border-gray-100 shadow-sm animate-fade-in relative overflow-hidden group">
                            <img src="${item.img}" class="w-20 h-20 rounded-xl object-cover bg-gray-100">
                            <div class="flex-grow flex flex-col justify-between">
                                <div>
                                    <h4 class="font-bold text-forest leading-tight">${item.name}</h4>
                                    <p class="text-xs text-gray-400 mt-0.5">₹${item.price} / pack</p>
                                </div>
                                <div class="flex items-center justify-between mt-2">
                                    <div class="flex items-center bg-gray-50 rounded-lg h-7 border border-gray-100">
                                        <button onclick="updateCartItem(${idx}, -1)" class="w-7 h-full flex items-center justify-center text-forest hover:bg-gray-100 rounded-l-lg"><i data-lucide="minus" class="w-3 h-3"></i></button>
                                        <span class="text-xs font-bold w-6 text-center">${item.qty}</span>
                                        <button onclick="updateCartItem(${idx}, 1)" class="w-7 h-full flex items-center justify-center text-forest hover:bg-gray-100 rounded-r-lg"><i data-lucide="plus" class="w-3 h-3"></i></button>
                                    </div>
                                    <span class="font-bold text-forest">₹${item.price * item.qty}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                document.getElementById('cart-total-price').innerText = `₹${total}`;
            }
            lucide.createIcons();
        }

        function updateCartItem(idx, delta) {
            playSound('click');
            if(state.cart[idx].qty + delta > 0) {
                state.cart[idx].qty += delta;
            } else {
                state.cart.splice(idx, 1);
            }
            saveState();
            openCart();
        }

        // --- SEARCH ---
        function openSearch() {
            playSound('click');
            document.getElementById('search-modal').classList.add('active');
            setTimeout(() => document.getElementById('search-input').focus(), 100);
        }

        function handleSearch(query) {
            const container = document.getElementById('search-results');
            if(!query) {
                container.innerHTML = '';
                return;
            }
            
            const results = products.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
            
            container.innerHTML = results.map(p => `
                <div onclick="closeModal('search-modal'); openProduct(${p.id})" class="bg-gray-50 rounded-xl p-2 flex items-center gap-3 cursor-pointer active:scale-95 transition-transform hover:bg-gray-100 border border-gray-100">
                    <img src="${p.img}" class="w-12 h-12 object-cover rounded-lg">
                    <div>
                        <p class="font-bold text-sm text-forest">${p.name}</p>
                        <p class="text-xs text-gray-500">₹${p.price}</p>
                    </div>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto text-gray-300"></i>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- UTILS ---
        function updateBadges() {
            const cartCount = state.cart.reduce((a,b) => a + b.qty, 0);
            const wishCount = state.wishlist.length;
            
            // Cart Badge
            const cartBadge = document.getElementById('cart-badge');
            cartBadge.innerText = cartCount;
            if(cartCount > 0) {
                cartBadge.classList.remove('opacity-0', 'scale-0');
            } else {
                cartBadge.classList.add('opacity-0', 'scale-0');
            }

            // Wishlist Badge
            const wishBadgeD = document.getElementById('wishlist-badge-desktop');
            const wishBadgeM = document.getElementById('wishlist-badge-mobile');
            
            if(wishCount > 0) {
                wishBadgeD.classList.remove('opacity-0');
                wishBadgeM.classList.remove('opacity-0');
            } else {
                wishBadgeD.classList.add('opacity-0');
                wishBadgeM.classList.add('opacity-0');
            }
        }

        function saveState() {
            localStorage.setItem('ls_cart', JSON.stringify(state.cart));
            localStorage.setItem('ls_wishlist', JSON.stringify(state.wishlist));
            updateBadges();
        }

        function showToast(title, msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-title').innerText = title;
            document.getElementById('toast-message').innerText = msg;
            
            toast.style.transform = 'translateX(0)';
            setTimeout(() => {
                toast.style.transform = 'translateX(150%)';
            }, 3000);
        }

        function scrollToGrid() {
            playSound('click');
            document.getElementById('grid-anchor').scrollIntoView({behavior: 'smooth'});
        }

        function filterProducts(type) {
            playSound('click');
            renderGrid(type);
            scrollToGrid();
        }

        function toggleWishlist() {
            playSound('click');
            const count = state.wishlist.length;
            if(count === 0) showToast('Wishlist', 'Your wishlist is empty');
            else showToast('Wishlist', `You have ${count} saved items`);
        }

        function initCheckout() {
            if(state.cart.length === 0) return;
            closeModal('cart-drawer');
            document.getElementById('checkout-modal').classList.add('active');
            playSound('click');
            setTimeout(() => {
                document.querySelector('#checkout-modal .sheet-content').classList.remove('scale-95', 'opacity-0');
            }, 50);
        }

        function processOrder(e) {
            e.preventDefault();
            const name = document.getElementById('c-name').value;
            const address = document.getElementById('c-address').value;
            
            let msg = `*New Order from ${name}*\n\n`;
            let total = 0;
            state.cart.forEach(i => {
                msg += `${i.qty}x ${i.name} - ₹${i.price*i.qty}\n`;
                total += i.price*i.qty;
            });
            msg += `\n*Total: ₹${total}*\n\nAddress: ${address}`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
            
            state.cart = [];
            saveState();
            closeModal('checkout-modal');
            showToast('Order Sent', 'Redirecting to WhatsApp...');
            playSound('success');
        }
        
        function switchTab(tab) {
             playSound('click');
             document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('text-forest'));
             event.currentTarget.classList.add('text-forest');
             if(tab === 'home') window.scrollTo({top: 0, behavior: 'smooth'});
        }

    </script>
</body>
</html>