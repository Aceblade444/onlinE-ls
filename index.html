<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#2A593E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Premium Organic Seeds & Spices">
    <title>Lightsprouts | Premium Seeds</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        forest: '#2A593E',        
                        leaf: '#7ED957',          
                        lime: '#D1FFBD',          
                        mint: '#F0FFE9',          
                        sand: '#fcfdfa',
                        dark: '#081C15',
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(42, 89, 62, 0.1)',
                        'glow': '0 0 15px rgba(126, 217, 87, 0.3)',
                        'nav': '0 4px 30px rgba(0,0,0,0.03)',
                        'float': '0 20px 25px -5px rgba(0, 0, 0, 0.1)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'bounce-sm': 'bounceSmall 0.2s cubic-bezier(0.4, 0, 0.2, 1)',
                        'marquee': 'marquee 30s linear infinite',
                        'spin-slow': 'spin 8s linear infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        bounceSmall: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(0.95)' } },
                        marquee: { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } },
                    }
                }
            }
        }
    </script>

    <style>
        /* CORE OPTIMIZATIONS */
        :root {
            --safe-bottom: env(safe-area-inset-bottom);
            --safe-top: env(safe-area-inset-top);
        }
        
        body {
            background-color: #fcfdfa;
            color: #2A593E;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            user-select: none; /* Disable text selection */
            -webkit-user-select: none;
        }

        /* Prevent image dragging and context menu */
        img {
            pointer-events: none;
            -webkit-user-drag: none;
            user-select: none;
        }

        /* Performance Optimizations */
        .hardware-accel {
            transform: translateZ(0);
            will-change: transform, opacity;
            backface-visibility: hidden;
        }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Modern Glass Effect - Optimized */
        .glass {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* Tap Effects */
        .tap-active { transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1); }
        .tap-active:active { transform: scale(0.95); }

        /* Loader */
        .loader-container {
            background: linear-gradient(135deg, #f0ffe9 0%, #ffffff 100%);
        }

        /* Enhanced Inputs */
        .input-premium {
            background: #F8FAFC;
            border: 1px solid #E2E8F0;
            transition: all 0.3s ease;
        }
        .input-premium:focus {
            background: #FFFFFF;
            border-color: #7ED957;
            box-shadow: 0 0 0 4px rgba(126, 217, 87, 0.1);
        }

        /* Marquee */
        .marquee-track { display: flex; width: max-content; }
        
        /* Modal Transitions */
        .modal-base {
            transition: opacity 0.3s ease, visibility 0.3s;
            opacity: 0;
            visibility: hidden;
        }
        .modal-base.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            transform: scale(0.95) translateY(10px);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .modal-base.active .modal-content {
            transform: scale(1) translateY(0);
        }
        
        /* Bottom Sheet */
        .sheet-base {
            transition: opacity 0.3s;
            opacity: 0;
            pointer-events: none;
        }
        .sheet-base.active {
            opacity: 1;
            pointer-events: auto;
        }
        .sheet-content {
            transform: translateY(100%);
            transition: transform 0.35s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .sheet-base.active .sheet-content {
            transform: translateY(0);
        }

    </style>
</head>
<body class="font-sans antialiased min-h-screen relative flex flex-col pb-24 md:pb-0 selection:bg-leaf selection:text-white" oncontextmenu="return false;">

    <!-- LOADER -->
    <div id="loader" class="fixed inset-0 z-[100] loader-container flex flex-col items-center justify-center transition-opacity duration-700">
        <div class="relative w-24 h-24 mb-6">
            <div class="absolute inset-0 border-4 border-mint rounded-full"></div>
            <div class="absolute inset-0 border-4 border-leaf rounded-full border-t-transparent animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center text-forest animate-pulse">
                <i data-lucide="sprout" class="w-10 h-10 fill-current"></i>
            </div>
        </div>
        <h1 class="text-3xl font-serif font-bold text-forest tracking-tight">lightsprouts<span class="text-leaf">.</span></h1>
    </div>

    <!-- APP HEADER -->
    <header class="fixed top-0 left-0 w-full z-40 transition-all duration-300 bg-white/90 backdrop-blur-md shadow-nav">
        <!-- Marquee -->
        <div class="bg-forest text-white overflow-hidden py-1.5 relative z-50">
            <div class="marquee-track animate-marquee">
                <span class="mx-4 text-[10px] font-bold uppercase tracking-widest flex items-center gap-2"><i data-lucide="zap" class="w-3 h-3 text-leaf"></i> Flash Sale: 20% Off Hybrid Seeds</span>
                <span class="mx-4 text-[10px] font-bold uppercase tracking-widest flex items-center gap-2"><i data-lucide="truck" class="w-3 h-3 text-leaf"></i> Free Delivery on Orders ₹499+</span>
                <span class="mx-4 text-[10px] font-bold uppercase tracking-widest flex items-center gap-2"><i data-lucide="shield-check" class="w-3 h-3 text-leaf"></i> 100% Germination Guarantee</span>
                <span class="mx-4 text-[10px] font-bold uppercase tracking-widest flex items-center gap-2"><i data-lucide="zap" class="w-3 h-3 text-leaf"></i> Flash Sale: 20% Off Hybrid Seeds</span>
                <span class="mx-4 text-[10px] font-bold uppercase tracking-widest flex items-center gap-2"><i data-lucide="truck" class="w-3 h-3 text-leaf"></i> Free Delivery on Orders ₹499+</span>
                <span class="mx-4 text-[10px] font-bold uppercase tracking-widest flex items-center gap-2"><i data-lucide="shield-check" class="w-3 h-3 text-leaf"></i> 100% Germination Guarantee</span>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-16 flex justify-between items-center relative">
            <!-- Logo -->
            <a href="#" onclick="window.scrollTo(0,0); playSound('click'); return false;" class="text-2xl font-serif font-bold text-forest flex items-center gap-1 tap-active">
                <div class="w-8 h-8 rounded-xl bg-gradient-to-br from-forest to-dark flex items-center justify-center text-white shadow-lg">
                    <i data-lucide="sprout" class="w-5 h-5 fill-current"></i>
                </div>
                lightsprouts
            </a>

            <!-- Desktop Nav -->
            <nav class="hidden md:flex items-center gap-2 bg-gray-50 p-1.5 rounded-full border border-gray-200">
                <button onclick="filterProducts('all')" class="nav-pill px-6 py-2 rounded-full text-sm font-bold transition-all bg-white text-forest shadow-md">All</button>
                <button onclick="filterProducts('spices')" class="nav-pill px-6 py-2 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white">Spices</button>
                <button onclick="filterProducts('hybrid')" class="nav-pill px-6 py-2 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white">Hybrid</button>
                <button onclick="filterProducts('fruit-seeds')" class="nav-pill px-6 py-2 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white">Fruits</button>
            </nav>

            <!-- Actions -->
            <div class="flex items-center gap-3">
                <div id="user-display" class="hidden md:flex items-center gap-2 mr-2">
                    <span id="user-name-display" class="text-xs font-bold text-forest bg-mint px-3 py-1 rounded-full"></span>
                </div>

                <button onclick="toggleSound()" class="w-10 h-10 hidden md:flex items-center justify-center rounded-full hover:bg-gray-100 text-forest transition-colors tap-active">
                    <i id="sound-icon" data-lucide="volume-2" class="w-5 h-5"></i>
                </button>

                <button onclick="openCart()" class="relative w-11 h-11 flex items-center justify-center rounded-full bg-forest text-white shadow-lg shadow-forest/20 tap-active hover:scale-105 transition-transform">
                    <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                    <span id="cart-badge" class="absolute -top-1 -right-1 bg-leaf text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center border-2 border-white scale-0 transition-transform duration-300">0</span>
                </button>
            </div>
        </div>

        <!-- Mobile Categories (Scrollable) -->
        <div class="md:hidden w-full bg-white border-b border-gray-100 py-3 px-4 overflow-x-auto no-scrollbar flex gap-3 snap-x">
            <button onclick="filterProducts('all')" class="cat-pill shrink-0 px-5 py-2 rounded-full text-xs font-bold bg-forest text-white shadow-md transition-all">All</button>
            <button onclick="filterProducts('spices')" class="cat-pill shrink-0 px-5 py-2 rounded-full text-xs font-bold bg-white text-forest border border-gray-200 shadow-sm transition-all">Spices</button>
            <button onclick="filterProducts('hybrid')" class="cat-pill shrink-0 px-5 py-2 rounded-full text-xs font-bold bg-white text-forest border border-gray-200 shadow-sm transition-all">Hybrid</button>
            <button onclick="filterProducts('vegetable-seeds')" class="cat-pill shrink-0 px-5 py-2 rounded-full text-xs font-bold bg-white text-forest border border-gray-200 shadow-sm transition-all">Veg</button>
            <button onclick="filterProducts('fruit-seeds')" class="cat-pill shrink-0 px-5 py-2 rounded-full text-xs font-bold bg-white text-forest border border-gray-200 shadow-sm transition-all">Fruits</button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow pt-[8.5rem] md:pt-32 px-4 sm:px-6 w-full max-w-7xl mx-auto z-10 relative">
        
        <!-- Hero -->
        <section class="relative w-full h-[400px] md:h-[450px] rounded-[2.5rem] overflow-hidden mb-10 shadow-float group">
            <img src="https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?q=80&w=2070&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover transition-transform duration-[4s] group-hover:scale-105">
            <div class="absolute inset-0 bg-gradient-to-r from-dark/90 via-dark/40 to-transparent"></div>
            
            <div class="absolute bottom-0 left-0 w-full p-8 md:p-16 flex flex-col items-start text-white">
                <span class="inline-block px-4 py-1.5 rounded-full bg-leaf/20 backdrop-blur-md border border-leaf/30 text-leaf text-xs font-bold uppercase tracking-widest mb-4">New Season</span>
                <h1 class="text-4xl md:text-7xl font-serif font-bold mb-4 leading-none hardware-accel">
                    Cultivate <br><span class="text-leaf italic">Excellence.</span>
                </h1>
                <p class="max-w-md mb-8 text-white/80 text-sm md:text-base font-medium leading-relaxed">
                    Premium organic seeds, rare spices, and high-yield hybrids delivered directly to your doorstep.
                </p>
                <button onclick="scrollToGrid()" class="h-14 bg-leaf text-forest font-bold px-8 rounded-2xl hover:bg-white transition-all flex items-center gap-3 shadow-glow tap-active group/btn text-base">
                    Shop Collection <i data-lucide="arrow-down" class="w-5 h-5 group-hover/btn:translate-y-1 transition-transform"></i>
                </button>
            </div>
        </section>

        <!-- Product Grid Header -->
        <div id="grid-anchor" class="flex items-center justify-between mb-6">
            <h2 class="text-2xl md:text-3xl font-serif font-bold text-forest">Discover</h2>
            <div class="text-xs font-bold text-gray-400 uppercase tracking-widest"><span id="count-display">0</span> Items</div>
        </div>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8 mb-24">
            <!-- Items injected by JS -->
        </div>

    </main>

    <!-- MOBILE BOTTOM NAV -->
    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur-xl border-t border-gray-100 z-50 pb-[env(safe-area-inset-bottom)] shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <div class="flex justify-around items-center h-16">
            <button onclick="switchTab('home')" class="flex flex-col items-center justify-center w-16 h-full text-forest tap-active">
                <i data-lucide="home" class="w-6 h-6"></i>
            </button>
            <button onclick="openCart()" class="flex flex-col items-center justify-center w-16 h-full text-gray-400 hover:text-forest tap-active relative">
                <i data-lucide="shopping-bag" class="w-6 h-6"></i>
                <span id="mobile-cart-badge" class="absolute top-3 right-3 w-2.5 h-2.5 bg-leaf rounded-full border-2 border-white scale-0 transition-transform"></span>
            </button>
            <button onclick="checkAuthAndOpen()" class="flex flex-col items-center justify-center w-16 h-full text-gray-400 hover:text-forest tap-active">
                <i id="mobile-auth-icon" data-lucide="user" class="w-6 h-6"></i>
            </button>
        </div>
    </nav>

    <!-- AUTH MODAL (Login/Register) -->
    <div id="auth-modal" class="fixed inset-0 z-[100] flex items-center justify-center px-4 pointer-events-none modal-base">
        <div class="absolute inset-0 bg-dark/60 backdrop-blur-sm transition-opacity" onclick="closeModal('auth-modal')"></div>
        <div class="modal-content relative w-full max-w-md bg-white rounded-3xl shadow-2xl pointer-events-auto overflow-hidden">
            
            <button onclick="closeModal('auth-modal')" class="absolute top-4 right-4 z-10 p-2 rounded-full bg-gray-50 text-forest hover:bg-gray-100 transition-colors tap-active">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>

            <!-- Tabs -->
            <div class="flex border-b border-gray-100">
                <button id="tab-login" onclick="switchAuthMode('login')" class="flex-1 py-5 text-center font-bold text-forest border-b-2 border-forest transition-colors">Login</button>
                <button id="tab-register" onclick="switchAuthMode('register')" class="flex-1 py-5 text-center font-bold text-gray-400 transition-colors">Register</button>
            </div>

            <div class="p-6 md:p-8 max-h-[75vh] overflow-y-auto">
                
                <!-- LOGIN FORM -->
                <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-serif font-bold text-forest">Welcome Back</h3>
                        <p class="text-sm text-gray-400">Access your saved details for faster checkout</p>
                    </div>
                    
                    <input type="email" id="l-email" required placeholder="Email Address" class="w-full h-14 px-4 rounded-xl input-premium text-forest placeholder:text-gray-400 font-medium outline-none">
                    <input type="password" id="l-password" required placeholder="Password" class="w-full h-14 px-4 rounded-xl input-premium text-forest placeholder:text-gray-400 font-medium outline-none">
                    
                    <button type="submit" class="w-full h-14 bg-forest text-white font-bold rounded-xl shadow-lg tap-active hover:bg-dark transition-colors">Sign In</button>
                </form>

                <!-- REGISTER FORM -->
                <form id="register-form" onsubmit="handleRegister(event)" class="space-y-4 hidden">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-serif font-bold text-forest">Create Account</h3>
                        <p class="text-sm text-gray-400">Your details will be auto-saved</p>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <input type="text" id="r-name" required placeholder="Full Name" class="w-full h-14 px-4 rounded-xl input-premium text-forest placeholder:text-gray-400 font-medium outline-none">
                        <input type="tel" id="r-phone" required placeholder="Phone" class="w-full h-14 px-4 rounded-xl input-premium text-forest placeholder:text-gray-400 font-medium outline-none">
                    </div>
                    
                    <textarea id="r-address" required rows="2" placeholder="Full Delivery Address (Auto-saved)" class="w-full p-4 rounded-xl input-premium text-forest placeholder:text-gray-400 font-medium outline-none resize-none"></textarea>
                    
                    <input type="email" id="r-email" required placeholder="Email Address" class="w-full h-14 px-4 rounded-xl input-premium text-forest placeholder:text-gray-400 font-medium outline-none">
                    <input type="password" id="r-password" required placeholder="Password (Min 6 chars)" class="w-full h-14 px-4 rounded-xl input-premium text-forest placeholder:text-gray-400 font-medium outline-none">

                    <button type="submit" class="w-full h-14 bg-leaf text-forest font-bold rounded-xl shadow-lg tap-active hover:bg-lime transition-colors">Create & Save</button>
                </form>

                <div class="relative my-6 text-center">
                    <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-100"></div></div>
                    <span class="relative px-3 bg-white text-xs font-bold text-gray-400 uppercase">Or</span>
                </div>

                <button onclick="handleGoogleAuth()" class="w-full h-14 bg-white border border-gray-200 text-forest font-bold rounded-xl flex items-center justify-center gap-3 tap-active hover:bg-gray-50 transition-colors">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="currentColor" d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/></svg>
                    Continue with Google
                </button>
            </div>
        </div>
    </div>

    <!-- PRODUCT DETAILS SHEET -->
    <div id="product-sheet" class="fixed inset-0 z-[90] flex justify-end items-end md:items-center md:justify-center pointer-events-none sheet-base">
        <div class="absolute inset-0 bg-dark/40 backdrop-blur-sm transition-opacity" onclick="closeSheet('product-sheet')"></div>
        
        <div class="sheet-content pointer-events-auto bg-[#FAFAF9] w-full md:w-[900px] md:rounded-[2.5rem] rounded-t-[2.5rem] shadow-2xl flex flex-col md:flex-row overflow-hidden relative max-h-[90vh] md:h-[600px]">
            
            <button onclick="closeSheet('product-sheet')" class="absolute top-5 right-5 z-20 w-10 h-10 rounded-full bg-white/80 backdrop-blur-md flex items-center justify-center text-forest shadow-lg tap-active">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>

            <!-- Image -->
            <div class="w-full md:w-1/2 h-64 md:h-full relative bg-gray-100">
                <img id="sheet-img" src="" class="w-full h-full object-cover">
                <div class="absolute bottom-4 left-4">
                    <span id="sheet-tag" class="px-3 py-1.5 rounded-lg bg-white/90 backdrop-blur text-xs font-bold uppercase tracking-wider text-forest shadow-sm">Organic</span>
                </div>
            </div>

            <!-- Details -->
            <div class="w-full md:w-1/2 p-6 md:p-10 flex flex-col bg-white overflow-y-auto pb-safe">
                <div class="mb-2 flex items-center gap-2">
                    <span id="sheet-cat" class="text-[10px] font-bold uppercase tracking-widest text-leaf">Category</span>
                    <div class="flex items-center text-yellow-400 gap-1">
                        <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                        <span class="text-xs font-bold text-forest">4.9</span>
                    </div>
                </div>
                
                <h2 id="sheet-title" class="text-3xl font-serif font-bold text-forest mb-2 leading-tight">Product Name</h2>
                
                <div class="flex items-baseline gap-3 mb-6">
                    <span id="sheet-price" class="text-2xl font-bold text-forest">₹0.00</span>
                    <span class="text-xs font-bold text-green-600 bg-green-100 px-2 py-0.5 rounded">In Stock</span>
                </div>

                <p id="sheet-desc" class="text-forest/70 text-sm leading-relaxed mb-8 font-medium">Description...</p>

                <!-- Footer Actions -->
                <div class="mt-auto pt-4 border-t border-gray-100">
                    <div class="flex items-center gap-4">
                        <div class="flex items-center bg-gray-50 rounded-xl h-14 border border-gray-100 px-2">
                            <button onclick="adjustQty(-1)" class="w-10 h-full flex items-center justify-center text-forest/50 hover:text-forest tap-active"><i data-lucide="minus" class="w-5 h-5"></i></button>
                            <span id="sheet-qty" class="w-8 text-center font-bold text-forest text-lg">1</span>
                            <button onclick="adjustQty(1)" class="w-10 h-full flex items-center justify-center text-forest/50 hover:text-forest tap-active"><i data-lucide="plus" class="w-5 h-5"></i></button>
                        </div>
                        
                        <button onclick="addToCart()" class="flex-grow h-14 bg-forest text-white font-bold rounded-xl shadow-lg shadow-forest/20 tap-active hover:bg-[#1e3f2d] transition-colors flex items-center justify-center gap-2 text-lg">
                            Add to Cart
                        </button>
                    </div>
                    <button onclick="instantBuy()" class="w-full mt-3 h-12 border-2 border-forest text-forest font-bold rounded-xl tap-active hover:bg-forest hover:text-white transition-colors flex items-center justify-center gap-2">
                        Buy Now <i data-lucide="zap" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CHECKOUT MODAL (If data missing) -->
    <div id="checkout-data-modal" class="fixed inset-0 z-[110] flex items-center justify-center px-4 pointer-events-none modal-base">
        <div class="absolute inset-0 bg-dark/60 backdrop-blur-sm transition-opacity" onclick="closeModal('checkout-data-modal')"></div>
        <div class="modal-content relative w-full max-w-md bg-white rounded-3xl shadow-2xl pointer-events-auto p-6 md:p-8">
            <button onclick="closeModal('checkout-data-modal')" class="absolute top-4 right-4 p-2 text-gray-400 hover:text-forest tap-active">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            
            <div class="text-center mb-6">
                <div class="w-14 h-14 bg-mint rounded-full flex items-center justify-center mx-auto mb-4 text-leaf animate-bounce-sm">
                    <i data-lucide="map-pin" class="w-7 h-7"></i>
                </div>
                <h3 class="text-xl font-serif font-bold text-forest">One Last Thing</h3>
                <p class="text-sm text-gray-400">We need these details for your delivery.</p>
            </div>

            <form onsubmit="saveAndCheckout(event)" class="space-y-4">
                <input type="text" id="checkout-name" required placeholder="Your Name" class="w-full h-12 px-4 rounded-xl input-premium text-forest outline-none">
                <input type="tel" id="checkout-phone" required placeholder="Phone Number" class="w-full h-12 px-4 rounded-xl input-premium text-forest outline-none">
                <textarea id="checkout-address" required rows="3" placeholder="Full Address" class="w-full p-4 rounded-xl input-premium text-forest outline-none resize-none"></textarea>
                <button type="submit" class="w-full h-14 bg-forest text-white font-bold rounded-xl shadow-lg tap-active flex items-center justify-center gap-2">
                    Proceed to WhatsApp <i data-lucide="message-circle" class="w-5 h-5"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- CART DRAWER -->
    <div id="cart-drawer" class="fixed inset-0 z-[100] flex justify-end pointer-events-none sheet-base">
        <div class="absolute inset-0 bg-dark/20 backdrop-blur-sm transition-opacity" onclick="closeSheet('cart-drawer')"></div>
        <div class="sheet-content pointer-events-auto bg-[#FAFAF9] w-full max-w-md h-full shadow-2xl flex flex-col translate-x-full md:translate-x-0 md:translate-y-0 transition-transform duration-300">
            
            <div class="p-5 flex justify-between items-center bg-white border-b border-gray-100">
                <h3 class="text-xl font-serif font-bold text-forest">My Basket</h3>
                <button onclick="closeSheet('cart-drawer')" class="p-2 rounded-full hover:bg-gray-100 text-forest tap-active">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div id="cart-container" class="flex-grow overflow-y-auto p-4 space-y-3 bg-gray-50">
                <!-- Items -->
            </div>

            <div class="p-6 bg-white border-t border-gray-100 pb-safe">
                <div class="flex justify-between items-baseline mb-4">
                    <span class="text-gray-500 font-bold text-sm">Total</span>
                    <span id="cart-total" class="text-2xl font-bold text-forest">₹0.00</span>
                </div>
                <button onclick="processCheckout()" class="w-full h-16 bg-leaf text-white font-bold rounded-2xl flex items-center justify-center gap-2 shadow-xl shadow-leaf/30 tap-active hover:bg-lime hover:text-forest transition-colors text-lg">
                    Checkout <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // --- CONFIG & STATE ---
        const firebaseConfig = {
            apiKey: "AIzaSyAHrBE3doAhDni4mcNhylJD8o3r5cNZYSI",
            authDomain: "ls-mannage.firebaseapp.com",
            databaseURL: "https://ls-mannage-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ls-mannage",
            storageBucket: "ls-mannage.firebasestorage.app",
            messagingSenderId: "115534926798",
            appId: "1:115534926798:web:4ea3ab3c1a2d44e2e1d19f",
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Extended Product Data
        const products = [
            { id: 1, type: 'hybrid', name: "Hybrid Tomato F1", price: 150, img: "https://images.unsplash.com/photo-1592841200221-a6898f307baa?q=80&w=600", desc: "High yield hybrid, disease resistant." },
            { id: 2, type: 'spices', name: "Kerala Cardamom", price: 299, img: "https://images.unsplash.com/photo-1599940829887-8d0df6080753?q=80&w=600", desc: "Aromatic green pods from organic estates." },
            { id: 3, type: 'fruit-seeds', name: "Sweet Strawberry", price: 180, img: "https://images.unsplash.com/photo-1543528176-61b239494933?q=80&w=600", desc: "Easy to grow, intensely sweet red berries." },
            { id: 4, type: 'vegetable-seeds', name: "Crunchy Carrot", price: 95, img: "https://images.unsplash.com/photo-1598170845058-78131a90f4a6?q=80&w=600", desc: "Vitamin-rich roots, perfect for pots." },
            { id: 5, type: 'spices', name: "Black Pepper", price: 250, img: "https://images.unsplash.com/photo-1551462147-37885acc36f1?q=80&w=600", desc: "The king of spices, spicy and pungent." },
            { id: 6, type: 'hybrid', name: "Hybrid Chili", price: 120, img: "https://images.unsplash.com/photo-1588252303782-cb80119abd6d?q=80&w=600", desc: "Extra spicy, prolific producer." },
            { id: 7, type: 'spices', name: "Cinnamon Bark", price: 180, img: "https://images.unsplash.com/photo-1556702758-5272a514d80a?q=80&w=600", desc: "Authentic Ceylon cinnamon." },
            { id: 8, type: 'fruit-seeds', name: "Watermelon Sugar", price: 110, img: "https://images.unsplash.com/photo-1589596660126-e75c5e317c2f?q=80&w=600", desc: "Sweet, juicy, summer refreshment." },
        ];

        let state = {
            cart: JSON.parse(localStorage.getItem('ls_cart')) || [],
            user: JSON.parse(localStorage.getItem('ls_user')) || null, // Contains {uid, name, email, phone, address}
            soundOn: true,
            currentProduct: null,
            tempQty: 1
        };

        // --- SOUND ENGINE (Optimized) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioContext();

        function playSound(type) {
            if (!state.soundOn || ctx.state === 'suspended') ctx.resume();
            
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            const now = ctx.currentTime;
            
            if (type === 'click') {
                // Thocky mechanical click
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(50, now + 0.05);
                gain.gain.setValueAtTime(0.15, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                osc.start(now);
                osc.stop(now + 0.05);
            } else if (type === 'success') {
                // Pleasant rising chime
                osc.type = 'sine';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.exponentialRampToValueAtTime(880, now + 0.2);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            }
        }

        function toggleSound() {
            state.soundOn = !state.soundOn;
            const icon = document.getElementById('sound-icon');
            icon.setAttribute('data-lucide', state.soundOn ? 'volume-2' : 'volume-x');
            lucide.createIcons();
            playSound('click');
        }

        // --- AUTH LOGIC ---
        function switchAuthMode(mode) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const tabLogin = document.getElementById('tab-login');
            const tabRegister = document.getElementById('tab-register');

            playSound('click');

            if (mode === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                tabLogin.classList.add('text-forest', 'border-forest');
                tabLogin.classList.remove('text-gray-400');
                tabRegister.classList.remove('text-forest', 'border-forest');
                tabRegister.classList.add('text-gray-400');
            } else {
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
                tabRegister.classList.add('text-forest', 'border-forest');
                tabRegister.classList.remove('text-gray-400');
                tabLogin.classList.remove('text-forest', 'border-forest');
                tabLogin.classList.add('text-gray-400');
            }
        }

        function saveUserLocally(userData) {
            state.user = userData;
            localStorage.setItem('ls_user', JSON.stringify(userData));
            updateUserUI();
        }

        async function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('r-name').value;
            const phone = document.getElementById('r-phone').value;
            const address = document.getElementById('r-address').value;
            const email = document.getElementById('r-email').value;
            const password = document.getElementById('r-password').value;

            try {
                const userCred = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCred.user;
                
                // Construct enhanced profile
                const fullProfile = {
                    uid: user.uid,
                    name: name,
                    email: email,
                    phone: phone,     // Saving extra field
                    address: address  // Saving extra field
                };

                saveUserLocally(fullProfile);
                closeModal('auth-modal');
                playSound('success');
            } catch (err) {
                alert(err.message);
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('l-email').value;
            const password = document.getElementById('l-password').value;

            try {
                const userCred = await auth.signInWithEmailAndPassword(email, password);
                // Attempt to merge with existing local data or fetch (simulated here since we lack DB write access)
                // In a real app, we'd fetch address from DB here. 
                // For this demo, we trust what's in localStorage or basic auth profile.
                const existing = JSON.parse(localStorage.getItem('ls_user'));
                const profile = {
                    uid: userCred.user.uid,
                    name: userCred.user.displayName || email.split('@')[0],
                    email: email,
                    phone: existing?.phone || '',
                    address: existing?.address || ''
                };
                
                saveUserLocally(profile);
                closeModal('auth-modal');
                playSound('success');
            } catch (err) {
                alert(err.message);
            }
        }

        async function handleGoogleAuth() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                const existing = JSON.parse(localStorage.getItem('ls_user'));
                const profile = {
                    uid: user.uid,
                    name: user.displayName,
                    email: user.email,
                    phone: existing?.phone || '',
                    address: existing?.address || ''
                };
                
                saveUserLocally(profile);
                closeModal('auth-modal');
                playSound('success');
            } catch (err) {
                console.error(err);
            }
        }

        function checkAuthAndOpen() {
            playSound('click');
            if(state.user) {
                if(confirm("Logout?")) {
                    auth.signOut();
                    state.user = null;
                    localStorage.removeItem('ls_user');
                    updateUserUI();
                    playSound('click');
                }
            } else {
                document.getElementById('auth-modal').classList.add('active');
            }
        }

        function updateUserUI() {
            const display = document.getElementById('user-name-display');
            const container = document.getElementById('user-display');
            const mobIcon = document.getElementById('mobile-auth-icon');

            if(state.user) {
                container.classList.remove('hidden');
                display.textContent = `Hi, ${state.user.name.split(' ')[0]}`;
                mobIcon.classList.add('text-leaf', 'fill-current');
            } else {
                container.classList.add('hidden');
                mobIcon.classList.remove('text-leaf', 'fill-current');
            }
        }

        // --- GRID & PRODUCTS ---
        function renderGrid(filter) {
            const grid = document.getElementById('product-grid');
            const data = filter === 'all' ? products : products.filter(p => p.type === filter);
            document.getElementById('count-display').textContent = data.length;

            // Highlight pills
            document.querySelectorAll('.cat-pill, .nav-pill').forEach(btn => {
                const isActive = btn.textContent.toLowerCase() === filter.replace('-seeds','');
                if(filter === 'all' && btn.textContent === 'All') btn.classList.add('bg-forest','text-white');
                else if(filter !== 'all' && btn.textContent.toLowerCase().includes(filter.replace('-seeds',''))) {
                    btn.classList.add('bg-forest','text-white');
                    btn.classList.remove('bg-white','text-forest','text-gray-500');
                } else {
                    btn.classList.remove('bg-forest','text-white');
                    btn.classList.add('bg-white', btn.classList.contains('cat-pill') ? 'text-forest' : 'text-gray-500');
                }
            });

            grid.innerHTML = data.map((p, idx) => `
                <div onclick="openProduct(${p.id})" class="group bg-white rounded-2xl p-2.5 shadow-sm border border-transparent hover:border-leaf/20 hover:shadow-soft transition-all duration-300 tap-active animate-slide-up" style="animation-delay: ${idx*0.05}s">
                    <div class="aspect-[4/5] rounded-xl overflow-hidden mb-3 relative bg-gray-100">
                        <img src="${p.img}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                        <button class="absolute bottom-2 right-2 w-9 h-9 rounded-full bg-white text-forest shadow-md flex items-center justify-center translate-y-10 group-hover:translate-y-0 transition-transform duration-300">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="px-1">
                        <p class="text-[10px] font-bold text-leaf uppercase tracking-wider mb-0.5">${p.type.replace('-seeds','')}</p>
                        <h3 class="font-bold text-forest leading-tight mb-2 h-10 line-clamp-2">${p.name}</h3>
                        <p class="text-lg font-bold text-forest">₹${p.price}</p>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function filterProducts(type) {
            playSound('click');
            renderGrid(type);
            document.getElementById('grid-anchor').scrollIntoView({behavior:'smooth'});
        }

        function openProduct(id) {
            playSound('click');
            const p = products.find(x => x.id === id);
            state.currentProduct = p;
            state.tempQty = 1;

            document.getElementById('sheet-img').src = p.img;
            document.getElementById('sheet-title').innerText = p.name;
            document.getElementById('sheet-price').innerText = `₹${p.price}`;
            document.getElementById('sheet-desc').innerText = p.desc;
            document.getElementById('sheet-qty').innerText = "1";
            document.getElementById('sheet-tag').innerText = p.type.toUpperCase();

            document.getElementById('product-sheet').classList.add('active');
        }

        // --- CART & CHECKOUT ---
        function adjustQty(d) {
            if(state.tempQty + d > 0) {
                state.tempQty += d;
                document.getElementById('sheet-qty').innerText = state.tempQty;
                playSound('click');
            }
        }

        function addToCart() {
            const existing = state.cart.find(x => x.id === state.currentProduct.id);
            if(existing) existing.qty += state.tempQty;
            else state.cart.push({...state.currentProduct, qty: state.tempQty});
            
            updateCartUI();
            closeSheet('product-sheet');
            playSound('success');
        }

        function instantBuy() {
            addToCart(); // Add to cart logic first
            // Wait slightly for UX then open cart/checkout
            setTimeout(() => {
                processCheckout();
            }, 300);
        }

        function updateCartUI() {
            localStorage.setItem('ls_cart', JSON.stringify(state.cart));
            const count = state.cart.reduce((a,b)=>a+b.qty,0);
            
            // Badges
            document.getElementById('cart-badge').innerText = count;
            document.getElementById('cart-badge').classList.toggle('scale-0', count === 0);
            document.getElementById('mobile-cart-badge').classList.toggle('scale-0', count === 0);

            // Drawer Render
            const container = document.getElementById('cart-container');
            let total = 0;
            
            if(state.cart.length === 0) {
                container.innerHTML = `<div class="text-center py-10 text-gray-400">Your basket is empty.</div>`;
            } else {
                container.innerHTML = state.cart.map(i => {
                    total += i.price * i.qty;
                    return `
                    <div class="flex gap-4 bg-white p-3 rounded-2xl shadow-sm border border-gray-100">
                        <img src="${i.img}" class="w-16 h-16 rounded-xl object-cover bg-gray-100">
                        <div class="flex-grow">
                            <h4 class="font-bold text-forest text-sm">${i.name}</h4>
                            <p class="text-xs text-gray-400 mb-2">₹${i.price} x ${i.qty}</p>
                            <div class="flex justify-between items-center">
                                <span class="font-bold text-forest">₹${i.price*i.qty}</span>
                                <button onclick="removeFromCart(${i.id})" class="text-xs font-bold text-red-400 p-2">Remove</button>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            }
            document.getElementById('cart-total').innerText = `₹${total}`;
        }

        function removeFromCart(id) {
            state.cart = state.cart.filter(x => x.id !== id);
            updateCartUI();
            playSound('click');
        }

        function openCart() {
            playSound('click');
            document.getElementById('cart-drawer').classList.add('active');
            updateCartUI();
        }

        function processCheckout() {
            playSound('click');
            if(state.cart.length === 0) return;

            // Check if user is logged in AND has details saved
            if (state.user && state.user.phone && state.user.address) {
                // Direct WhatsApp
                sendToWhatsApp(state.user.name, state.user.phone, state.user.address);
            } else {
                // Need details
                closeSheet('cart-drawer');
                // Pre-fill if some data exists
                if(state.user) {
                    document.getElementById('checkout-name').value = state.user.name || '';
                    document.getElementById('checkout-phone').value = state.user.phone || '';
                    document.getElementById('checkout-address').value = state.user.address || '';
                }
                document.getElementById('checkout-data-modal').classList.add('active');
            }
        }

        function saveAndCheckout(e) {
            e.preventDefault();
            const name = document.getElementById('checkout-name').value;
            const phone = document.getElementById('checkout-phone').value;
            const address = document.getElementById('checkout-address').value;

            // Save for next time even if not registered fully
            if(state.user) {
                state.user.phone = phone;
                state.user.address = address;
                localStorage.setItem('ls_user', JSON.stringify(state.user));
            }

            closeModal('checkout-data-modal');
            sendToWhatsApp(name, phone, address);
        }

        function sendToWhatsApp(name, phone, address) {
            let msg = `*New Order: Lightsprouts*\n\n*Customer:*\n${name}\n${phone}\n${address}\n\n*Items:*\n`;
            let total = 0;
            state.cart.forEach(i => {
                msg += `- ${i.qty}x ${i.name} (₹${i.price * i.qty})\n`;
                total += i.price * i.qty;
            });
            msg += `\n*TOTAL: ₹${total}*`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
            
            // Clear cart
            state.cart = [];
            updateCartUI();
            playSound('success');
        }

        // --- UTILS ---
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            playSound('click');
        }
        
        function closeSheet(id) {
             document.getElementById(id).classList.remove('active');
             playSound('click');
        }
        
        function scrollToGrid() {
            playSound('click');
            document.getElementById('grid-anchor').scrollIntoView({behavior: 'smooth'});
        }

        function switchTab(tab) {
            if(tab === 'home') window.scrollTo({top:0, behavior:'smooth'});
            playSound('click');
        }

        // --- INIT ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loader').classList.add('opacity-0');
                setTimeout(() => document.getElementById('loader').remove(), 700);
            }, 1500);
            
            renderGrid('all');
            updateUserUI();
            updateCartUI();
            lucide.createIcons();
        });

    </script>
</body>
</html>
