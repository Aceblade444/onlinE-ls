<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#2A593E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Lightsprouts | Premium Seeds</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        forest: '#2A593E',        
                        leaf: '#7ED957',          
                        lime: '#D1FFBD',          
                        mint: '#F0FFE9',          
                        sand: '#fcfdfa',
                        dark: '#081C15',
                        amber: '#F59E0B',
                        spice: '#92400E',
                        hybrid: '#10B981',
                        glass: {
                            100: 'rgba(255, 255, 255, 0.1)',
                            200: 'rgba(255, 255, 255, 0.2)',
                            300: 'rgba(255, 255, 255, 0.3)',
                            400: 'rgba(255, 255, 255, 0.4)',
                            border: 'rgba(255, 255, 255, 0.4)',
                        }
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(42, 89, 62, 0.15)',
                        'glow': '0 0 20px rgba(126, 217, 87, 0.4)',
                        'nav': '0 -4px 20px rgba(0,0,0,0.05)',
                        'float': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                        'popup': '0 25px 50px -12px rgba(42, 89, 62, 0.25), 0 0 50px rgba(126, 217, 87, 0.15)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'slide-up': 'slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'bounce-sm': 'bounceSmall 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                        'float': 'float 6s ease-in-out infinite',
                        'bloom': 'bloom 2s ease-in-out infinite',
                        'gentle-pulse': 'gentlePulse 3s ease-in-out infinite',
                        'text-glow': 'textGlow 2s ease-in-out infinite',
                        'marquee-scroll': 'marqueeScroll 40s linear infinite',
                        'marquee-scroll-reverse': 'marqueeScrollReverse 40s linear infinite',
                        'icon-spin': 'iconSpin 8s linear infinite',
                        'gradient-shift': 'gradientShift 4s ease infinite alternate',
                        'shimmer': 'shimmer 2s linear infinite',
                        'pop-in': 'popIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'popup-enter': 'popupEnter 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards',
                        'glow-pulse': 'glowPulse 2s ease-in-out infinite',
                        'slide-left': 'slideLeft 0.5s ease-out forwards',
                        'slide-right': 'slideRight 0.5s ease-out forwards',
                        'leaf-wiggle': 'leafWiggle 1.5s ease-in-out infinite alternate',
                        'leaf-fall': 'leafFall 3s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        popIn: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        bounceSmall: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(0.95)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        bloom: { '0%, 100%': { transform: 'scale(1)', opacity: '0.8' }, '50%': { transform: 'scale(1.05)', opacity: '1' } },
                        gentlePulse: { '0%, 100%': { opacity: 0.6 }, '50%': { opacity: 1 } },
                        textGlow: { '0%, 100%': { 'text-shadow': '0 0 10px rgba(126, 217, 87, 0.5)' }, '50%': { 'text-shadow': '0 0 20px rgba(126, 217, 87, 0.8)' } },
                        marqueeScroll: { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } },
                        marqueeScrollReverse: { '0%': { transform: 'translateX(-50%)' }, '100%': { transform: 'translateX(0)' } },
                        iconSpin: { '0%': { transform: 'rotate(0deg)' }, '100%': { transform: 'rotate(360deg)' } },
                        gradientShift: { '0%': { 'background-position': '0% 50%' }, '100%': { 'background-position': '100% 50%' } },
                        shimmer: { '100%': { transform: 'translateX(100%)' } },
                        popupEnter: { 
                            '0%': { transform: 'scale(0.3) rotate(-2deg)', opacity: '0' }, 
                            '70%': { transform: 'scale(1.05) rotate(1deg)' },
                            '100%': { transform: 'scale(1) rotate(0)', opacity: '1' } 
                        },
                        glowPulse: {
                            '0%, 100%': { 'box-shadow': '0 0 20px rgba(126, 217, 87, 0.3)' },
                            '50%': { 'box-shadow': '0 0 40px rgba(126, 217, 87, 0.6)' }
                        },
                        slideLeft: {
                            '0%': { transform: 'translateX(100px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        slideRight: {
                            '0%': { transform: 'translateX(-100px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        leafWiggle: {
                            '0%': { transform: 'rotate(-2deg) translateX(-2px)' },
                            '100%': { transform: 'rotate(2deg) translateX(2px)' }
                        },
                        leafFall: {
                            '0%': { transform: 'translateY(-100px) rotate(0deg)', opacity: '0' },
                            '10%': { opacity: '1' },
                            '90%': { opacity: '1' },
                            '100%': { transform: 'translateY(100vh) rotate(360deg)', opacity: '0' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE STYLES */
        :root {
            --safe-bottom: env(safe-area-inset-bottom);
            --safe-top: env(safe-area-inset-top);
        }
        
        body {
            background-color: #fcfdfa;
            color: #2A593E;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            /* Prevent text selection */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* Texture */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
        }

        /* Prevent image dragging */
        img {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
            pointer-events: none;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* GLASS MORPHISM */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(42, 89, 62, 0.05);
        }

        /* ANIMATIONS */
        .tap-active:active { transform: scale(0.96); transition: transform 0.1s; }

        /* MOBILE-OPTIMIZED BUTTONS */
        .mobile-btn {
            min-height: 44px;
            min-width: 44px;
            padding: 12px 20px;
            font-size: 16px;
            touch-action: manipulation;
        }

        /* LOADER - LEAF THEME */
        .loader-container {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: linear-gradient(135deg, #2A593E 0%, #3a7a56 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .leaf {
            position: absolute;
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #7ed957, #d1ffbd);
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            opacity: 0.7;
            animation: leafFall 3s ease-in-out infinite;
        }

        .leaf:nth-child(1) { 
            left: 10%; 
            animation-delay: 0s; 
            animation-duration: 4s;
        }
        .leaf:nth-child(2) { 
            left: 20%; 
            animation-delay: 1s; 
            animation-duration: 3.5s;
        }
        .leaf:nth-child(3) { 
            left: 30%; 
            animation-delay: 2s; 
            animation-duration: 4.5s;
        }
        .leaf:nth-child(4) { 
            left: 40%; 
            animation-delay: 0.5s; 
            animation-duration: 3s;
        }
        .leaf:nth-child(5) { 
            left: 50%; 
            animation-delay: 1.5s; 
            animation-duration: 4s;
        }
        .leaf:nth-child(6) { 
            left: 60%; 
            animation-delay: 2.5s; 
            animation-duration: 3.5s;
        }
        .leaf:nth-child(7) { 
            left: 70%; 
            animation-delay: 0.8s; 
            animation-duration: 4.2s;
        }
        .leaf:nth-child(8) { 
            left: 80%; 
            animation-delay: 1.8s; 
            animation-duration: 3.8s;
        }
        .leaf:nth-child(9) { 
            left: 90%; 
            animation-delay: 0.3s; 
            animation-duration: 4.7s;
        }

        .sprout-loader {
            width: 120px;
            height: 200px;
            position: relative;
            animation: leafWiggle 1.5s ease-in-out infinite alternate;
        }

        .sprout-stem {
            width: 8px;
            height: 120px;
            background: linear-gradient(to top, #2A593E, #7ED957);
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 4px;
        }

        .sprout-leaf {
            width: 50px;
            height: 50px;
            background: #7ED957;
            position: absolute;
            border-radius: 50% 50% 50% 0;
            transform-origin: bottom center;
        }

        .leaf-left {
            top: 60px;
            left: 10px;
            transform: rotate(-45deg);
        }

        .leaf-right {
            top: 60px;
            right: 10px;
            transform: rotate(45deg) scaleX(-1);
        }

        .bud {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #D1FFBD, #7ED957);
            border-radius: 50%;
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            animation: gentlePulse 2s ease-in-out infinite;
        }

        /* ENHANCED MARQUEE STYLES */
        .marquee-container {
            position: relative;
            overflow: hidden;
            background: linear-gradient(90deg, #2A593E 0%, #3a7a56 50%, #2A593E 100%);
            animation: gradientShift 4s ease infinite alternate;
            box-shadow: 0 4px 15px rgba(42, 89, 62, 0.2);
        }
        
        .marquee-container::before, .marquee-container::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #7ED957, transparent);
            z-index: 10;
        }
        .marquee-container::before { top: 0; }
        .marquee-container::after { bottom: 0; }

        .marquee-track {
            display: flex;
            align-items: center;
            width: max-content;
            padding: 4px 0;
        }

        .marquee-item {
            display: flex;
            align-items: center;
            margin: 0 1.5rem;
            white-space: nowrap;
        }

        .marquee-text {
            color: #ffffff;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 0.2rem 0.6rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 99px;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .marquee-primary { animation: marquee-scroll 35s linear infinite; }
        .marquee-secondary { animation: marquee-scroll-reverse 40s linear infinite; }

        .marquee-track:hover { animation-play-state: paused; }

        /* MODAL & DRAWER TRANSITIONS */
        .modal-enter {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal-enter.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-enter .sheet-content {
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .modal-enter.active .sheet-content {
            transform: translateY(0);
        }
        
        /* Mobile Nav */
        .bottom-nav { 
            padding-bottom: calc(10px + var(--safe-bottom)); 
            padding-top: 10px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.05);
        }

        /* Skeleton Shimmer */
        .skeleton {
            background: #f0f0f0;
            position: relative;
            overflow: hidden;
        }
        .skeleton::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 100%);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }

        /* Promo Pop-up Specifics */
        .promo-overlay {
            background: rgba(8, 28, 21, 0.8);
            backdrop-filter: blur(20px);
        }

        ::selection { background: #D1FFBD; color: #2A593E; }

        /* Disable text selection */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body class="font-sans antialiased min-h-screen relative flex flex-col pb-24 md:pb-0 no-select">

    <!-- LEAF-THEME LOADER -->
    <div id="loader" class="loader-container">
        <div class="absolute inset-0 overflow-hidden">
            <div class="leaf"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
        </div>
        
        <div class="sprout-loader z-10">
            <div class="sprout-stem"></div>
            <div class="sprout-leaf leaf-left"></div>
            <div class="sprout-leaf leaf-right"></div>
            <div class="bud"></div>
        </div>
        
        <h1 class="text-4xl md:text-5xl font-serif font-bold text-white mt-12 mb-2 animate-text-glow text-center">
            lightsprouts<span class="text-lime">.</span>
        </h1>
        <p class="text-white/80 font-medium tracking-wider text-xs md:text-sm uppercase">Growing Your Green Dreams</p>
    </div>

    <!-- AUTH MODAL (Login/Register) -->
    <div id="auth-modal" class="fixed inset-0 z-[999] flex items-center justify-center px-4 pointer-events-none opacity-0 invisible transition-all duration-500">
        <div class="absolute inset-0 bg-gradient-to-br from-forest/90 via-dark/90 to-forest/80 backdrop-blur-xl transition-opacity" onclick="closeAuthModal()"></div>
        
        <div class="relative w-full max-w-md bg-gradient-to-b from-white via-mint/30 to-white rounded-3xl shadow-popup overflow-hidden transform scale-95 transition-all duration-500 pointer-events-auto flex flex-col max-h-[90vh] border-2 border-leaf/30 animate-popup-enter">
            
            <!-- Close Button -->
            <button onclick="closeAuthModal()" class="absolute top-5 right-5 z-30 w-12 h-12 rounded-full bg-white flex items-center justify-center text-forest border-2 border-forest/20 hover:bg-forest hover:text-white hover:border-forest transition-all duration-300 tap-active shadow-lg group/close mobile-btn">
                <i data-lucide="x" class="w-6 h-6 group-hover/close:rotate-90 transition-transform"></i>
            </button>

            <!-- Tabs -->
            <div class="flex border-b border-gray-200">
                <button id="login-tab" class="flex-1 py-4 text-center font-bold text-forest border-b-2 border-forest transition-all mobile-btn" onclick="switchAuthTab('login')">
                    Login
                </button>
                <button id="register-tab" class="flex-1 py-4 text-center font-bold text-gray-400 transition-all mobile-btn" onclick="switchAuthTab('register')">
                    Register
                </button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="p-6">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-mint rounded-full flex items-center justify-center mx-auto mb-4 text-leaf animate-bounce-sm">
                        <i data-lucide="sprout" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-2xl font-serif font-bold text-forest">Welcome Back</h3>
                    <p class="text-gray-400 text-sm mt-2">Sign in to continue your green journey</p>
                </div>

                <form id="login-email-form" class="space-y-4" onsubmit="loginWithEmail(event)">
                    <div>
                        <label class="block text-sm font-medium text-forest mb-1">Email</label>
                        <input type="email" id="login-email" required placeholder="your@email.com" 
                               class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-forest mb-1">Password</label>
                        <input type="password" id="login-password" required placeholder="••••••••" 
                               class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="flex items-center">
                            <input type="checkbox" id="remember-me" checked
                                   class="w-5 h-5 text-leaf bg-gray-100 border-gray-300 rounded focus:ring-leaf/20 focus:ring-2">
                            <span class="ml-2 text-sm text-gray-600">Remember me</span>
                        </label>
                        <button type="button" class="text-sm text-forest hover:text-leaf font-medium" onclick="showForgotPassword()">Forgot password?</button>
                    </div>
                    
                    <button type="submit" class="w-full bg-forest text-white font-bold py-4 rounded-xl mt-4 shadow-xl tap-active hover:bg-[#1e3f2d] transition-colors mobile-btn text-base">
                        Sign In
                    </button>
                </form>

                <!-- Divider -->
                <div class="flex items-center my-6">
                    <div class="flex-grow border-t border-gray-200"></div>
                    <span class="mx-4 text-gray-400 text-sm">Or continue with</span>
                    <div class="flex-grow border-t border-gray-200"></div>
                </div>

                <!-- Google Sign In -->
                <button onclick="signInWithGoogle()" class="w-full bg-white border border-gray-200 text-forest font-bold py-4 rounded-xl flex items-center justify-center gap-3 shadow-sm tap-active hover:bg-gray-50 transition-colors mobile-btn">
                    <svg class="w-6 h-6" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Sign in with Google
                </button>
            </div>

            <!-- Register Form -->
            <div id="register-form" class="p-6 hidden">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-mint rounded-full flex items-center justify-center mx-auto mb-4 text-leaf animate-bounce-sm">
                        <i data-lucide="seedling" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-2xl font-serif font-bold text-forest">Join Our Community</h3>
                    <p class="text-gray-400 text-sm mt-2">Start your green journey with us</p>
                </div>

                <form id="register-email-form" class="space-y-4" onsubmit="registerWithEmail(event)">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-forest mb-1">First Name</label>
                            <input type="text" id="register-firstname" required placeholder="John" 
                                   class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-forest mb-1">Last Name</label>
                            <input type="text" id="register-lastname" required placeholder="Doe" 
                                   class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-forest mb-1">Phone Number</label>
                        <input type="tel" id="register-phone" required placeholder="+91 9876543210" 
                               class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-forest mb-1">Address</label>
                        <textarea id="register-address" required rows="2" placeholder="Your complete delivery address" 
                               class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base resize-none"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-forest mb-1">Email</label>
                        <input type="email" id="register-email" required placeholder="your@email.com" 
                               class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-forest mb-1">Password</label>
                        <input type="password" id="register-password" required placeholder="••••••••" 
                               class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                        <p class="text-xs text-gray-400 mt-1">Minimum 6 characters</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-forest mb-1">Confirm Password</label>
                        <input type="password" id="register-confirm-password" required placeholder="••••••••" 
                               class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                    </div>
                    
                    <label class="flex items-start">
                        <input type="checkbox" id="terms" required
                               class="w-5 h-5 text-leaf bg-gray-100 border-gray-300 rounded focus:ring-leaf/20 focus:ring-2 mt-1">
                        <span class="ml-2 text-sm text-gray-600">I agree to the <a href="#" class="text-forest hover:text-leaf font-medium">Terms of Service</a> and <a href="#" class="text-forest hover:text-leaf font-medium">Privacy Policy</a></span>
                    </label>
                    
                    <button type="submit" class="w-full bg-leaf text-forest font-bold py-4 rounded-xl mt-4 shadow-xl tap-active hover:bg-[#6ec248] transition-colors mobile-btn text-base">
                        Create Account
                    </button>
                </form>

                <!-- Divider -->
                <div class="flex items-center my-6">
                    <div class="flex-grow border-t border-gray-200"></div>
                    <span class="mx-4 text-gray-400 text-sm">Or sign up with</span>
                    <div class="flex-grow border-t border-gray-200"></div>
                </div>

                <!-- Google Sign Up -->
                <button onclick="signInWithGoogle()" class="w-full bg-white border border-gray-200 text-forest font-bold py-4 rounded-xl flex items-center justify-center gap-3 shadow-sm tap-active hover:bg-gray-50 transition-colors mobile-btn">
                    <svg class="w-6 h-6" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Sign up with Google
                </button>
            </div>
        </div>
    </div>

    <!-- FORGOT PASSWORD MODAL -->
    <div id="forgot-password-modal" class="fixed inset-0 z-[1000] flex items-center justify-center px-4 pointer-events-none opacity-0 invisible transition-all duration-500">
        <div class="absolute inset-0 bg-gradient-to-br from-forest/90 via-dark/90 to-forest/80 backdrop-blur-xl transition-opacity" onclick="closeForgotPassword()"></div>
        
        <div class="relative w-full max-w-md bg-gradient-to-b from-white via-mint/30 to-white rounded-3xl shadow-popup overflow-hidden transform scale-95 transition-all duration-500 pointer-events-auto flex flex-col max-h-[85vh] border-2 border-leaf/30 animate-popup-enter p-6">
            
            <button onclick="closeForgotPassword()" class="absolute top-5 right-5 z-30 w-12 h-12 rounded-full bg-white flex items-center justify-center text-forest border-2 border-forest/20 hover:bg-forest hover:text-white hover:border-forest transition-all duration-300 tap-active shadow-lg group/close mobile-btn">
                <i data-lucide="x" class="w-6 h-6 group-hover/close:rotate-90 transition-transform"></i>
            </button>

            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-mint rounded-full flex items-center justify-center mx-auto mb-4 text-leaf animate-bounce-sm">
                    <i data-lucide="key" class="w-8 h-8"></i>
                </div>
                <h3 class="text-2xl font-serif font-bold text-forest">Reset Password</h3>
                <p class="text-gray-400 text-sm mt-2">Enter your email to reset your password</p>
            </div>

            <form id="forgot-password-form" class="space-y-4" onsubmit="resetPassword(event)">
                <div>
                    <label class="block text-sm font-medium text-forest mb-1">Email Address</label>
                    <input type="email" id="reset-email" required placeholder="your@email.com" 
                           class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-4 text-forest focus:outline-none focus:ring-2 focus:ring-leaf/20 focus:border-leaf transition-all placeholder:text-gray-400 text-base">
                </div>
                
                <button type="submit" class="w-full bg-forest text-white font-bold py-4 rounded-xl mt-4 shadow-xl tap-active hover:bg-[#1e3f2d] transition-colors mobile-btn">
                    Send Reset Link
                </button>
                
                <button type="button" onclick="closeForgotPassword(); switchAuthTab('login')" 
                        class="w-full text-forest hover:text-leaf font-medium py-3 mobile-btn">
                    Back to Login
                </button>
            </form>
        </div>
    </div>

    <!-- APP HEADER -->
    <header class="fixed top-0 left-0 w-full z-40 transition-all duration-300 shadow-nav bg-white/80 backdrop-blur-xl">
        
        <!-- ENHANCED MARQUEE -->
        <div class="marquee-container z-50">
            <!-- Primary Track -->
            <div class="marquee-track marquee-primary">
                <div class="marquee-item"><i data-lucide="sprout" class="w-3 h-3 text-lime mr-2 animate-spin-slow"></i><span class="marquee-text">Premium Organic Seeds</span></div>
                <div class="marquee-item"><i data-lucide="check-circle" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">95% Germination Guarantee</span></div>
                <div class="marquee-item"><i data-lucide="truck" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">Free Shipping ₹500+</span></div>
                <div class="marquee-item"><i data-lucide="shield" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">Certified Organic</span></div>
                <!-- Duplicate -->
                <div class="marquee-item"><i data-lucide="sprout" class="w-3 h-3 text-lime mr-2 animate-spin-slow"></i><span class="marquee-text">Premium Organic Seeds</span></div>
                <div class="marquee-item"><i data-lucide="check-circle" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">95% Germination Guarantee</span></div>
                <div class="marquee-item"><i data-lucide="truck" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">Free Shipping ₹500+</span></div>
                <div class="marquee-item"><i data-lucide="shield" class="w-3 h-3 text-lime mr-2"></i><span class="marquee-text">Certified Organic</span></div>
            </div>
        </div>

        <!-- Main Nav Bar -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-16 md:h-16 flex justify-between items-center relative">
            
            <!-- Logo -->
            <a href="#" onclick="window.scrollTo(0,0); playSound('click'); return false;" class="text-xl md:text-2xl font-serif font-bold text-forest flex items-center gap-1 tap-active">
                <div class="w-9 h-9 rounded-full bg-forest flex items-center justify-center text-lime shadow-lg">
                    <i data-lucide="sprout" class="w-6 h-6 fill-current"></i>
                </div>
                lightsprouts
            </a>

            <!-- Desktop Menu -->
            <nav class="hidden md:flex items-center gap-1 bg-gray-100/50 p-1 rounded-full border border-gray-200">
                <button onclick="filterProducts('all')" class="nav-pill px-5 py-2 rounded-full text-sm font-bold transition-all bg-white text-forest shadow-sm border border-gray-100">All</button>
                <button onclick="filterProducts('fruit-seeds')" class="nav-pill px-5 py-2 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white/50">Fruits</button>
                <button onclick="filterProducts('vegetable-seeds')" class="nav-pill px-5 py-2 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white/50">Veg</button>
                <button onclick="filterProducts('spice-seeds')" class="nav-pill px-5 py-2 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white/50">Spices</button>
                <button onclick="filterProducts('hybrid-seeds')" class="nav-pill px-5 py-2 rounded-full text-sm font-semibold text-gray-500 hover:text-forest transition-all hover:bg-white/50">Hybrid</button>
            </nav>

            <!-- Actions -->
            <div class="flex items-center gap-2 md:gap-3">
                <!-- User Profile -->
                <div id="user-profile" class="hidden items-center gap-2">
                    <div class="w-9 h-9 rounded-full bg-mint flex items-center justify-center text-leaf font-bold shadow-sm" id="user-avatar">
                        U
                    </div>
                    <div class="hidden md:block">
                        <p class="text-xs font-bold text-forest" id="user-name">User</p>
                        <button onclick="logout()" class="text-[10px] text-gray-400 hover:text-red-500 mobile-btn">Logout</button>
                    </div>
                </div>

                <!-- Login Button -->
                <button id="login-button" onclick="openAuthModal()" class="flex items-center gap-2 px-4 py-2.5 rounded-full text-sm font-semibold text-forest hover:bg-forest/5 transition-colors tap-active mobile-btn">
                    <i data-lucide="log-in" class="w-5 h-5"></i>
                    <span class="hidden md:inline">Login</span>
                </button>

                <!-- Sound Toggle -->
                <button onclick="toggleSound()" class="w-11 h-11 flex items-center justify-center rounded-full hover:bg-forest/5 text-forest transition-colors tap-active mobile-btn hidden md:flex" title="Toggle Sound">
                    <i id="sound-icon-desktop" data-lucide="volume-2" class="w-6 h-6"></i>
                </button>

                <button onclick="openSearch()" class="w-11 h-11 flex items-center justify-center rounded-full hover:bg-forest/5 text-forest transition-colors tap-active mobile-btn hidden md:flex">
                    <i data-lucide="search" class="w-6 h-6"></i>
                </button>

                <button onclick="openCart()" class="relative w-11 h-11 md:w-12 md:h-12 flex items-center justify-center rounded-full bg-forest text-white shadow-glow hover:bg-forest/90 transition-all tap-active mobile-btn group">
                    <i data-lucide="shopping-bag" class="w-6 h-6"></i>
                    <span id="cart-badge" class="absolute -top-1 -right-1 bg-leaf text-white text-[11px] font-bold w-5 h-5 rounded-full flex items-center justify-center opacity-0 scale-0 transition-all duration-300 border border-white shadow-sm">0</span>
                </button>
            </div>
        </div>

        <!-- Sticky Mobile Categories -->
        <div class="md:hidden w-full bg-white/95 backdrop-blur-xl border-b border-gray-100 py-3 px-4 overflow-x-auto no-scrollbar flex gap-2 snap-x shadow-sm">
            <button onclick="filterProducts('all')" class="cat-pill snap-start whitespace-nowrap px-5 py-2.5 rounded-full text-sm font-bold bg-forest text-white shadow-sm transition-all border border-transparent mobile-btn">All Seeds</button>
            <button onclick="filterProducts('fruit-seeds')" class="cat-pill snap-start whitespace-nowrap px-5 py-2.5 rounded-full text-sm font-bold bg-white text-forest border border-gray-200 transition-all mobile-btn">Fruits</button>
            <button onclick="filterProducts('vegetable-seeds')" class="cat-pill snap-start whitespace-nowrap px-5 py-2.5 rounded-full text-sm font-bold bg-white text-forest border border-gray-200 transition-all mobile-btn">Vegetables</button>
            <button onclick="filterProducts('spice-seeds')" class="cat-pill snap-start whitespace-nowrap px-5 py-2.5 rounded-full text-sm font-bold bg-white text-forest border border-gray-200 transition-all mobile-btn">Spices</button>
            <button onclick="filterProducts('hybrid-seeds')" class="cat-pill snap-start whitespace-nowrap px-5 py-2.5 rounded-full text-sm font-bold bg-white text-forest border border-gray-200 transition-all mobile-btn">Hybrid</button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow pt-[9.5rem] md:pt-36 px-4 sm:px-6 w-full max-w-7xl mx-auto z-10 relative">
        
        <!-- Hero Section -->
        <section class="relative w-full h-[50vh] md:h-[450px] rounded-[2rem] overflow-hidden mb-8 shadow-float group">
            <img id="hero-img" src="https://images.unsplash.com/photo-1530836369250-ef72a3f5cda8?q=80&w=2070&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover transition-transform duration-[3s] group-hover:scale-105">
            <div class="absolute inset-0 bg-gradient-to-t from-dark/80 via-dark/20 to-transparent"></div>
            
            <div class="absolute bottom-0 left-0 w-full p-6 md:p-12 flex flex-col items-start text-white">
                <div class="flex items-center gap-2 mb-3 animate-fade-in">
                    <span class="px-3 py-1.5 rounded-full bg-white/20 backdrop-blur-md border border-white/20 text-xs font-bold uppercase tracking-wider">New Arrival</span>
                    <span class="w-2 h-2 rounded-full bg-leaf animate-pulse"></span>
                </div>
                <h1 class="text-4xl md:text-6xl font-serif font-bold mb-3 leading-tight animate-fade-in" style="animation-delay: 0.1s">
                    Grow your <br><span class="text-lime italic">sanctuary.</span>
                </h1>
                <p class="max-w-md mb-6 text-sm opacity-90 leading-relaxed animate-fade-in hidden md:block" style="animation-delay: 0.2s">
                    Premium organic seeds sourced from sustainable farms. 95% germination guarantee.
                </p>
                <button onclick="scrollToGrid()" class="bg-leaf text-forest font-bold py-3.5 px-7 rounded-xl hover:bg-lime transition-all flex items-center gap-2 shadow-glow tap-active animate-fade-in group/btn text-base md:text-lg mobile-btn" style="animation-delay: 0.3s">
                    Start Growing <i data-lucide="arrow-down" class="w-5 h-5 group-hover/btn:translate-y-1 transition-transform"></i>
                </button>
            </div>
        </section>

        <!-- Stats Bar -->
        <div class="grid grid-cols-3 gap-2 mb-8 bg-white/60 p-4 rounded-2xl border border-white/50 shadow-sm backdrop-blur-sm animate-fade-in">
            <div class="text-center">
                <p class="text-xl md:text-2xl font-serif font-bold text-forest">95%</p>
                <p class="text-[10px] md:text-[11px] font-bold text-gray-400 uppercase tracking-wider">Germination</p>
            </div>
            <div class="text-center border-l border-gray-200">
                <p class="text-xl md:text-2xl font-serif font-bold text-forest">100%</p>
                <p class="text-[10px] md:text-[11px] font-bold text-gray-400 uppercase tracking-wider">Organic</p>
            </div>
            <div class="text-center border-l border-gray-200">
                <p class="text-xl md:text-2xl font-serif font-bold text-forest">24/7</p>
                <p class="text-[10px] md:text-[11px] font-bold text-gray-400 uppercase tracking-wider">Support</p>
            </div>
        </div>

        <!-- Product Grid Header -->
        <div id="grid-anchor" class="flex items-end justify-between mb-4 px-1">
            <div>
                <h2 class="text-xl md:text-2xl font-serif font-bold text-forest flex items-center gap-2">
                    Curated Seeds
                    <span id="item-count-badge" class="bg-forest/10 text-forest text-[11px] px-2.5 py-1 rounded-full font-sans font-bold align-middle">10</span>
                </h2>
            </div>
            <button class="text-forest/60 hover:text-forest text-sm font-bold uppercase tracking-wider flex items-center gap-1 bg-white px-4 py-2 rounded-full shadow-sm border border-gray-100 mobile-btn">
                Sort <i data-lucide="chevron-down" class="w-4 h-4"></i>
            </button>
        </div>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 mb-24">
            <!-- Loading Skeletons -->
            <div class="rounded-2xl overflow-hidden aspect-[4/5] skeleton"></div>
            <div class="rounded-2xl overflow-hidden aspect-[4/5] skeleton"></div>
            <div class="rounded-2xl overflow-hidden aspect-[4/5] skeleton"></div>
            <div class="rounded-2xl overflow-hidden aspect-[4/5] skeleton"></div>
        </div>

    </main>

    <!-- MOBILE BOTTOM NAVIGATION -->
    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur-xl border-t border-gray-200 z-40 bottom-nav flex justify-around items-center pt-3 pb-1">
        <button onclick="switchTab('home')" class="nav-item active flex flex-col items-center gap-1 text-forest w-16 tap-active transition-colors mobile-btn">
            <i data-lucide="home" class="w-7 h-7"></i>
            <span class="text-[11px] font-bold">Home</span>
        </button>
        <button onclick="openSearch()" class="nav-item flex flex-col items-center gap-1 text-gray-400 hover:text-forest w-16 tap-active transition-colors mobile-btn">
            <i data-lucide="search" class="w-7 h-7"></i>
            <span class="text-[11px] font-medium">Search</span>
        </button>
        <button onclick="openAuthModal()" class="nav-item flex flex-col items-center gap-1 text-gray-400 hover:text-forest w-16 tap-active transition-colors mobile-btn">
            <i id="user-icon-mobile" data-lucide="user" class="w-7 h-7"></i>
            <span class="text-[11px] font-medium">Account</span>
        </button>
    </nav>

    <!-- PRODUCT DETAIL SHEET/MODAL -->
    <div id="product-modal" class="fixed inset-0 z-50 flex items-end md:items-center justify-center pointer-events-none modal-enter">
        <div class="absolute inset-0 bg-dark/40 backdrop-blur-sm transition-opacity" onclick="closeModal('product-modal')"></div>
        
        <div class="sheet-content pointer-events-auto bg-[#FAFAF9] w-full md:w-[900px] md:h-[600px] rounded-t-[2rem] md:rounded-[2.5rem] shadow-2xl flex flex-col md:flex-row overflow-hidden relative max-h-[92vh] md:max-h-[85vh]">
            
            <div class="md:hidden absolute top-3 left-1/2 -translate-x-1/2 w-12 h-1.5 bg-gray-300 rounded-full z-20"></div>
            
            <button onclick="closeModal('product-modal')" class="absolute top-4 right-4 z-20 bg-white/80 p-2.5 rounded-full hover:bg-forest hover:text-white transition-colors text-forest backdrop-blur-sm tap-active shadow-sm border border-gray-100 mobile-btn">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>

            <!-- Image Side -->
            <div class="w-full md:w-1/2 h-72 md:h-full bg-gray-100 relative group">
                <img id="modal-img" src="" class="w-full h-full object-cover">
                <div class="absolute bottom-4 left-4 right-4 flex gap-2">
                    <span id="modal-tag" class="glass-card px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wide text-forest backdrop-blur-md border-white/40">Organic</span>
                </div>
            </div>

            <!-- Content Side -->
            <div class="w-full md:w-1/2 p-6 md:p-10 flex flex-col overflow-y-auto pb-28 md:pb-10 bg-gradient-to-b from-white to-mint/20">
                <div class="mb-2 flex items-center gap-2 opacity-60">
                    <span id="modal-cat" class="text-xs font-bold uppercase tracking-widest text-forest">Category</span>
                    <span class="w-1 h-1 bg-forest rounded-full"></span>
                    <div class="flex items-center text-yellow-500">
                        <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                        <span class="text-xs text-forest ml-1 font-bold" id="modal-rating-text">4.8</span>
                    </div>
                </div>
                
                <h2 id="modal-title" class="text-3xl md:text-4xl font-serif font-bold text-forest mb-2 leading-tight">Product Name</h2>
                
                <div class="flex items-baseline gap-3 mb-6">
                    <span id="modal-price" class="text-2xl font-bold text-leaf">₹0.00</span>
                    <span id="modal-original-price" class="text-gray-400 text-sm line-through decoration-red-400">₹0.00</span>
                </div>

                <p id="modal-desc" class="text-forest/70 text-sm leading-relaxed mb-8 font-medium">
                    Description goes here...
                </p>

                <!-- Info Grid -->
                <div class="grid grid-cols-2 gap-3 mb-8">
                    <div class="bg-white p-3 rounded-2xl border border-gray-100 shadow-sm flex items-center gap-3">
                        <div class="w-9 h-9 rounded-full bg-orange-100 flex items-center justify-center text-orange-500">
                            <i data-lucide="sun" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <span class="block text-[11px] font-bold text-gray-400 uppercase">Season</span>
                            <span id="modal-season" class="text-xs font-bold text-forest">All Year</span>
                        </div>
                    </div>
                    <div class="bg-white p-3 rounded-2xl border border-gray-100 shadow-sm flex items-center gap-3">
                        <div class="w-9 h-9 rounded-full bg-blue-100 flex items-center justify-center text-blue-500">
                            <i data-lucide="clock" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <span class="block text-[11px] font-bold text-gray-400 uppercase">Harvest</span>
                            <span id="modal-harvest" class="text-xs font-bold text-forest">60 Days</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="mt-auto pt-4 border-t border-forest/5">
                    <div class="flex items-center gap-3">
                        <!-- Qty -->
                        <div class="flex items-center bg-white border border-gray-200 rounded-xl px-1 h-14 shadow-sm shrink-0">
                            <button onclick="adjustQty(-1)" class="w-12 h-full flex items-center justify-center text-forest/60 hover:text-forest active:scale-90 mobile-btn"><i data-lucide="minus" class="w-5 h-5"></i></button>
                            <span id="qty-display" class="w-8 text-center font-bold text-forest text-base">1</span>
                            <button onclick="adjustQty(1)" class="w-12 h-full flex items-center justify-center text-forest/60 hover:text-forest active:scale-90 mobile-btn"><i data-lucide="plus" class="w-5 h-5"></i></button>
                        </div>
                        
                        <!-- Main Action -->
                        <button onclick="addToCart()" class="flex-grow h-14 bg-forest text-white font-bold rounded-xl shadow-lg shadow-forest/20 tap-active flex items-center justify-center gap-2 hover:bg-[#1e3f2d] transition-colors mobile-btn text-base">
                            Add <span id="add-price" class="text-sm font-normal opacity-70"></span>
                        </button>

                        <button onclick="toggleWishlistItem(currentItem.id)" id="modal-heart-btn" class="h-14 w-14 shrink-0 rounded-xl border border-gray-200 bg-white flex items-center justify-center text-forest hover:bg-red-50 hover:text-red-500 hover:border-red-200 transition-colors tap-active shadow-sm mobile-btn">
                            <i data-lucide="heart" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <!-- Direct Buy Button -->
                    <button onclick="directBuy()" class="w-full h-14 bg-leaf text-forest font-bold rounded-xl shadow-lg shadow-leaf/20 tap-active flex items-center justify-center gap-2 hover:bg-[#6ec248] transition-colors mt-4 mobile-btn text-base">
                        <i data-lucide="message-circle" class="w-5 h-5"></i>
                        Buy Now on WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CART DRAWER -->
    <div id="cart-drawer" class="fixed inset-0 z-[60] flex justify-end pointer-events-none modal-enter">
        <div class="absolute inset-0 bg-dark/20 backdrop-blur-sm transition-opacity" onclick="closeModal('cart-drawer')"></div>
        <div class="sheet-content bg-[#FAFAF9] w-full max-w-md h-full shadow-2xl pointer-events-auto flex flex-col translate-x-full" style="transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);">
            
            <div class="p-6 flex justify-between items-center bg-white border-b border-gray-100 sticky top-0 z-10">
                <h3 class="text-xl font-serif font-bold text-forest flex items-center gap-2">
                    <div class="w-9 h-9 rounded-full bg-mint flex items-center justify-center text-leaf">
                        <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                    </div>
                    My Basket
                </h3>
                <button onclick="closeModal('cart-drawer')" class="p-2.5 rounded-full hover:bg-gray-100 text-forest/60 transition-colors tap-active mobile-btn">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div id="cart-items-container" class="flex-grow overflow-y-auto p-4 space-y-3 bg-gray-50/50">
                <!-- Items injected here -->
            </div>

            <div class="p-6 bg-white border-t border-gray-100 mt-auto shadow-[0_-4px_20px_rgba(0,0,0,0.03)] pb-8 md:pb-6">
                <div class="flex justify-between items-baseline mb-4">
                    <span class="text-gray-500 text-sm font-medium">Total Estimate</span>
                    <span id="cart-total-price" class="text-2xl font-bold text-forest">₹0.00</span>
                </div>
                <button onclick="checkoutToWhatsApp()" class="w-full bg-leaf text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-leaf/20 tap-active hover:bg-[#6ec248] transition-colors mobile-btn text-base">
                    Checkout on WhatsApp
                    <i data-lucide="message-circle" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed top-24 right-4 md:right-8 z-[80] bg-white/90 backdrop-blur-md border border-gray-200 shadow-float rounded-2xl p-4 flex items-center gap-3 translate-x-[150%] transition-transform duration-500 max-w-[90vw] w-auto">
        <div class="w-9 h-9 rounded-full bg-leaf text-white flex items-center justify-center shrink-0 shadow-sm">
            <i data-lucide="check" class="w-5 h-5"></i>
        </div>
        <div>
            <h4 class="font-bold text-forest text-base" id="toast-title">Success</h4>
            <p class="text-sm text-gray-500" id="toast-message">Action completed.</p>
        </div>
    </div>

    <!-- SEARCH MODAL -->
    <div id="search-modal" class="fixed inset-0 z-50 bg-white/95 backdrop-blur-xl modal-enter flex flex-col">
        <div class="pt-12 px-4 pb-4 border-b border-gray-100 flex items-center gap-3">
            <i data-lucide="search" class="text-gray-400 w-6 h-6"></i>
            <input type="text" id="search-input" placeholder="Search for seeds..." class="flex-grow bg-transparent text-lg font-medium text-forest placeholder:text-gray-300 focus:outline-none text-base" oninput="handleSearch(this.value)">
            <button onclick="closeModal('search-modal')" class="text-sm font-bold text-gray-400 bg-gray-100 px-4 py-2 rounded-full mobile-btn">Cancel</button>
        </div>
        <div id="search-results" class="flex-grow overflow-y-auto p-4 grid grid-cols-2 gap-3 content-start">
            <!-- Results -->
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAHrBE3doAhDni4mcNhylJD8o3r5cNZYSI",
            authDomain: "ls-mannage.firebaseapp.com",
            databaseURL: "https://ls-mannage-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ls-mannage",
            storageBucket: "ls-mannage.firebasestorage.app",
            messagingSenderId: "115534926798",
            appId: "1:115534926798:web:4ea3ab3c1a2d44e2e1d19f",
            measurementId: "G-P2JQH8M41Y"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // --- DATA ---
        const products = [
            { id: 1, type: 'fruit-seeds', name: "Heirloom Tomato", price: 120, originalPrice: 150, img: "https://images.unsplash.com/photo-1592841200221-a6898f307baa?q=80&w=600&auto=format&fit=crop", desc: "Juicy, rich-flavored tomatoes perfect for salads and sauces.", germ: "98%", time: "60 Days", rating: 4.8 },
            { id: 2, type: 'vegetable-seeds', name: "Spicy Chilli", price: 80, originalPrice: 95, img: "https://images.unsplash.com/photo-1588252303782-cb80119abd6d?q=80&w=600&auto=format&fit=crop", desc: "High heat variety, excellent for adding kick to your dishes.", germ: "95%", time: "75 Days", rating: 4.6 },
            { id: 3, type: 'spice-seeds', name: "Fresh Coriander", price: 45, originalPrice: null, img: "https://images.unsplash.com/photo-1596043225276-2afc36c2d0b9?q=80&w=600&auto=format&fit=crop", desc: "Aromatic herb essential for garnishing and cooking.", germ: "90%", time: "35 Days", rating: 4.5 },
            { id: 4, type: 'fruit-seeds', name: "Sweet Strawberry", price: 180, originalPrice: 220, img: "https://images.unsplash.com/photo-1543528176-61b239494933?q=80&w=600&auto=format&fit=crop", desc: "Red, sweet berries that grow well in pots or ground.", germ: "85%", time: "90 Days", rating: 4.9 },
            { id: 5, type: 'vegetable-seeds', name: "Crunchy Carrot", price: 95, originalPrice: 110, img: "https://images.unsplash.com/photo-1598170845058-78131a90f4a6?q=80&w=600&auto=format&fit=crop", desc: "Vitamin-rich roots with a satisfying crunch.", germ: "92%", time: "70 Days", rating: 4.7 },
            { id: 6, type: 'spice-seeds', name: "Holy Basil", price: 60, originalPrice: null, img: "https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=600&auto=format&fit=crop", desc: "Sacred medicinal plant known for immunity boosting.", germ: "88%", time: "45 Days", rating: 4.8 },
            { id: 7, type: 'fruit-seeds', name: "Watermelon", price: 110, originalPrice: 140, img: "https://images.unsplash.com/photo-1589596660126-e75c5e317c2f?q=80&w=600&auto=format&fit=crop", desc: "Summer favorite, grows large and sweet.", germ: "85%", time: "85 Days", rating: 4.5 },
            { id: 8, type: 'vegetable-seeds', name: "Spinach", price: 55, originalPrice: 70, img: "https://images.unsplash.com/photo-1576045057995-568f588f82fb?q=80&w=600&auto=format&fit=crop", desc: "Iron-packed leafy green, grows quickly.", germ: "95%", time: "40 Days", rating: 4.4 },
            { id: 9, type: 'hybrid-seeds', name: "Hybrid Cherry Tomato", price: 150, originalPrice: 180, img: "https://images.unsplash.com/photo-1592841200221-a6898f307baa?q=80&w=600&auto=format&fit=crop", desc: "Disease-resistant, high-yield cherry tomato variety.", germ: "97%", time: "55 Days", rating: 4.9 },
            { id: 10, type: 'spice-seeds', name: "Turmeric", price: 75, originalPrice: null, img: "https://images.unsplash.com/photo-1596496181871-9681eacf9764?q=80&w=600&auto=format&fit=crop", desc: "Golden spice with anti-inflammatory properties.", germ: "85%", time: "200 Days", rating: 4.7 },
        ];

        // --- STATE ---
        let state = {
            cart: JSON.parse(localStorage.getItem('ls_cart')) || [],
            wishlist: JSON.parse(localStorage.getItem('ls_wishlist')) || [],
            soundEnabled: JSON.parse(localStorage.getItem('ls_sound')) !== false,
            currentItem: null,
            tempQty: 1,
            user: JSON.parse(localStorage.getItem('ls_user')) || null,
            userDetails: JSON.parse(localStorage.getItem('ls_user_details')) || null
        };

        // --- SOUND ENGINE (IMPROVED) ---
        const soundEffects = {
            click: () => {
                if (!state.soundEnabled) return;
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.value = 600;
                    gain.gain.setValueAtTime(0.08, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.15);
                } catch(e){}
            },
            success: () => {
                if (!state.soundEnabled) return;
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.setValueAtTime(523.25, ctx.currentTime);
                    osc.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1);
                    osc.frequency.setValueAtTime(783.99, ctx.currentTime + 0.2);
                    gain.gain.setValueAtTime(0.06, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.4);
                } catch(e){}
            },
            add: () => {
                if (!state.soundEnabled) return;
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.setValueAtTime(400, ctx.currentTime);
                    osc.frequency.setValueAtTime(500, ctx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.05, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.2);
                } catch(e){}
            }
        };

        function playSound(type) {
            if(soundEffects[type]) {
                soundEffects[type]();
            }
        }

        function toggleSound() {
            state.soundEnabled = !state.soundEnabled;
            localStorage.setItem('ls_sound', JSON.stringify(state.soundEnabled));
            updateSoundIcons();
            showToast(state.soundEnabled ? 'Sound On' : 'Sound Off', 'Audio effects updated');
            playSound('click');
        }

        function updateSoundIcons() {
            const iconD = document.getElementById('sound-icon-desktop');
            const iconName = state.soundEnabled ? 'volume-2' : 'volume-x';
            
            if(iconD) {
                iconD.setAttribute('data-lucide', iconName);
                if(!state.soundEnabled) iconD.classList.add('text-gray-400');
                else iconD.classList.remove('text-gray-400');
            }
            lucide.createIcons();
        }

        // --- AUTH FUNCTIONS ---
        function openAuthModal() {
            playSound('click');
            const modal = document.getElementById('auth-modal');
            modal.classList.remove('opacity-0', 'invisible', 'pointer-events-none');
            modal.classList.add('opacity-100');
            
            const content = modal.querySelector('div.relative');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
            
            // Switch to register tab if user data exists but not saved
            if (state.user && !state.userDetails) {
                setTimeout(() => switchAuthTab('register'), 100);
            }
        }

        function closeAuthModal() {
            const modal = document.getElementById('auth-modal');
            if(modal) {
                const content = modal.querySelector('div.relative');
                content.classList.remove('scale-100');
                content.classList.add('scale-95');
                
                modal.classList.remove('opacity-100');
                modal.classList.add('opacity-0');
                setTimeout(() => {
                    modal.classList.add('invisible', 'pointer-events-none');
                }, 500);
                playSound('click');
            }
        }

        function switchAuthTab(tab) {
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            if(tab === 'login') {
                loginTab.classList.add('text-forest', 'border-forest');
                loginTab.classList.remove('text-gray-400');
                registerTab.classList.remove('text-forest', 'border-forest');
                registerTab.classList.add('text-gray-400');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerTab.classList.add('text-forest', 'border-forest');
                registerTab.classList.remove('text-gray-400');
                loginTab.classList.remove('text-forest', 'border-forest');
                loginTab.classList.add('text-gray-400');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
                
                // Auto-fill if user exists
                if (state.user) {
                    document.getElementById('register-email').value = state.user.email || '';
                    if (state.user.displayName) {
                        const names = state.user.displayName.split(' ');
                        document.getElementById('register-firstname').value = names[0] || '';
                        document.getElementById('register-lastname').value = names.slice(1).join(' ') || '';
                    }
                }
            }
            playSound('click');
        }

        function showForgotPassword() {
            closeAuthModal();
            const modal = document.getElementById('forgot-password-modal');
            modal.classList.remove('opacity-0', 'invisible', 'pointer-events-none');
            modal.classList.add('opacity-100');
            
            const content = modal.querySelector('div.relative');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
        }

        function closeForgotPassword() {
            const modal = document.getElementById('forgot-password-modal');
            if(modal) {
                const content = modal.querySelector('div.relative');
                content.classList.remove('scale-100');
                content.classList.add('scale-95');
                
                modal.classList.remove('opacity-100');
                modal.classList.add('opacity-0');
                setTimeout(() => {
                    modal.classList.add('invisible', 'pointer-events-none');
                }, 500);
                playSound('click');
            }
        }

        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                state.user = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL
                };
                
                localStorage.setItem('ls_user', JSON.stringify(state.user));
                
                // Check if user details exist in database
                const userDetailsRef = database.ref('users/' + user.uid);
                userDetailsRef.once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        state.userDetails = snapshot.val();
                        localStorage.setItem('ls_user_details', JSON.stringify(state.userDetails));
                    }
                });
                
                updateUIForUser();
                closeAuthModal();
                showToast('Welcome!', `Hello ${user.displayName || user.email}`);
                playSound('success');
            } catch (error) {
                console.error('Google sign-in error:', error);
                showToast('Error', error.message);
            }
        }

        async function loginWithEmail(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                state.user = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName || email.split('@')[0]
                };
                
                localStorage.setItem('ls_user', JSON.stringify(state.user));
                
                // Get user details from database
                const userDetailsRef = database.ref('users/' + user.uid);
                userDetailsRef.once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        state.userDetails = snapshot.val();
                        localStorage.setItem('ls_user_details', JSON.stringify(state.userDetails));
                    }
                });
                
                updateUIForUser();
                closeAuthModal();
                showToast('Welcome Back!', `Good to see you again`);
                playSound('success');
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login Failed', error.message);
            }
        }

        async function registerWithEmail(event) {
            event.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const firstName = document.getElementById('register-firstname').value;
            const lastName = document.getElementById('register-lastname').value;
            const phone = document.getElementById('register-phone').value;
            const address = document.getElementById('register-address').value;
            
            if (password !== confirmPassword) {
                showToast('Error', 'Passwords do not match');
                return;
            }
            
            if (password.length < 6) {
                showToast('Error', 'Password must be at least 6 characters');
                return;
            }
            
            try {
                await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Update profile with name
                await user.updateProfile({
                    displayName: `${firstName} ${lastName}`
                });
                
                state.user = {
                    uid: user.uid,
                    email: user.email,
                    displayName: `${firstName} ${lastName}`
                };
                
                // Save user details to database
                const userDetails = {
                    firstName: firstName,
                    lastName: lastName,
                    phone: phone,
                    address: address,
                    email: email,
                    createdAt: new Date().toISOString()
                };
                
                await database.ref('users/' + user.uid).set(userDetails);
                state.userDetails = userDetails;
                
                localStorage.setItem('ls_user', JSON.stringify(state.user));
                localStorage.setItem('ls_user_details', JSON.stringify(userDetails));
                
                updateUIForUser();
                closeAuthModal();
                showToast('Welcome!', `Account created successfully`);
                playSound('success');
            } catch (error) {
                console.error('Registration error:', error);
                showToast('Registration Failed', error.message);
            }
        }

        async function resetPassword(event) {
            event.preventDefault();
            const email = document.getElementById('reset-email').value;
            
            try {
                await auth.sendPasswordResetEmail(email);
                closeForgotPassword();
                showToast('Email Sent', 'Check your inbox for reset instructions');
                playSound('success');
            } catch (error) {
                console.error('Password reset error:', error);
                showToast('Error', error.message);
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                state.user = null;
                state.userDetails = null;
                localStorage.removeItem('ls_user');
                localStorage.removeItem('ls_user_details');
                updateUIForUser();
                showToast('Logged Out', 'See you soon!');
                playSound('click');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function updateUIForUser() {
            const userProfile = document.getElementById('user-profile');
            const loginButton = document.getElementById('login-button');
            const userIconMobile = document.getElementById('user-icon-mobile');
            
            if (state.user) {
                userProfile.classList.remove('hidden');
                loginButton.classList.add('hidden');
                
                document.getElementById('user-name').textContent = 
                    state.user.displayName || state.user.email.split('@')[0];
                
                const avatar = document.getElementById('user-avatar');
                if (state.user.photoURL) {
                    avatar.innerHTML = `<img src="${state.user.photoURL}" class="w-full h-full rounded-full object-cover">`;
                } else {
                    const initials = state.user.displayName ? 
                        state.user.displayName.split(' ').map(n => n[0]).join('').toUpperCase() :
                        state.user.email[0].toUpperCase();
                    avatar.textContent = initials;
                }
                
                if (userIconMobile) {
                    userIconMobile.setAttribute('data-lucide', 'user-check');
                    lucide.createIcons();
                }
            } else {
                userProfile.classList.add('hidden');
                loginButton.classList.remove('hidden');
                
                if (userIconMobile) {
                    userIconMobile.setAttribute('data-lucide', 'user');
                    lucide.createIcons();
                }
            }
        }

        // Check auth state on page load
        auth.onAuthStateChanged((user) => {
            if (user) {
                state.user = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL
                };
                localStorage.setItem('ls_user', JSON.stringify(state.user));
                
                // Load user details from database
                const userDetailsRef = database.ref('users/' + user.uid);
                userDetailsRef.once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        state.userDetails = snapshot.val();
                        localStorage.setItem('ls_user_details', JSON.stringify(state.userDetails));
                    }
                });
            } else {
                state.user = null;
                state.userDetails = null;
                localStorage.removeItem('ls_user');
                localStorage.removeItem('ls_user_details');
            }
            updateUIForUser();
        });

        // --- INIT ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loader = document.getElementById('loader');
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    renderGrid('all');
                }, 1000);
            }, 2000);
            
            setTimeout(() => {
                renderGrid('all');
            }, 500);

            updateBadges();
            updateSoundIcons();
            updateUIForUser();
            
            lucide.createIcons();
            
            // Performance optimization: Use passive listeners
            document.addEventListener('touchstart', function() {}, { passive: true });
            document.addEventListener('touchmove', function() {}, { passive: true });
        });

        // --- RENDER FUNCTIONS ---
        function renderGrid(filter) {
            const grid = document.getElementById('product-grid');
            const data = filter === 'all' ? products : products.filter(p => p.type === filter);
            
            const countBadge = document.getElementById('item-count-badge');
            if(countBadge) countBadge.innerText = data.length;

            // Update active state of pills
            document.querySelectorAll('.cat-pill, .nav-pill').forEach(btn => {
                const btnText = btn.textContent.toLowerCase();
                const isActive = (filter === 'all' && btnText.includes('all')) || 
                               (filter !== 'all' && btnText.includes(filter.replace('-seeds', '').replace('vegetable', 'veg')));
                
                if(isActive) {
                    btn.classList.add('bg-forest', 'text-white', 'border-forest', 'shadow-sm');
                    btn.classList.remove('bg-white', 'text-forest', 'text-gray-500');
                } else {
                    btn.classList.remove('bg-forest', 'text-white', 'border-forest', 'shadow-sm');
                    if(btn.classList.contains('nav-pill')) {
                        btn.classList.add('text-gray-500');
                    } else {
                        btn.classList.add('bg-white', 'text-forest');
                    }
                }
            });

            // Optimized rendering with requestAnimationFrame
            requestAnimationFrame(() => {
                grid.innerHTML = data.map((p, idx) => `
                    <div class="group bg-white rounded-2xl p-3 border border-transparent hover:border-leaf/30 shadow-sm hover:shadow-soft transition-all duration-300 cursor-pointer animate-slide-up" 
                         style="animation-delay: ${idx * 0.03}s"
                         onclick="openProduct(${p.id})">
                        <div class="aspect-[4/5] rounded-xl overflow-hidden relative bg-gray-100 mb-3">
                            <img src="${p.img}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                            ${p.originalPrice ? `<div class="absolute top-2 left-2 bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm">- ${(100 - (p.price/p.originalPrice)*100).toFixed(0)}%</div>` : ''}
                            <button onclick="event.stopPropagation(); toggleWishlistItem(${p.id})" class="absolute top-2 right-2 w-8 h-8 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center text-forest hover:bg-white transition-all tap-active hover:scale-110 shadow-sm mobile-btn">
                                <i data-lucide="heart" class="w-4 h-4 ${state.wishlist.includes(p.id) ? 'fill-red-500 text-red-500' : ''}"></i>
                            </button>
                        </div>
                        <div class="px-1">
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="font-bold text-forest text-sm md:text-base leading-tight line-clamp-1 group-hover:text-leaf transition-colors">${p.name}</h3>
                                <div class="flex items-center gap-0.5 text-[11px] font-bold text-yellow-500 bg-yellow-50 px-1.5 rounded">
                                    <i data-lucide="star" class="w-3 h-3 fill-current"></i> ${p.rating}
                                </div>
                            </div>
                            <p class="text-[10px] md:text-[11px] text-gray-400 font-bold uppercase tracking-wider mb-2">${p.type.replace('-seeds', '').replace('spice', 'Spice').replace('hybrid', 'Hybrid')}</p>
                            <div class="flex items-baseline gap-2">
                                <span class="text-base md:text-lg font-bold text-forest">₹${p.price}</span>
                                ${p.originalPrice ? `<span class="text-[11px] text-gray-400 line-through">₹${p.originalPrice}</span>` : ''}
                            </div>
                            <button onclick="event.stopPropagation(); directBuyFromCard(${p.id})" class="w-full mt-3 py-2.5 bg-leaf text-forest font-bold rounded-lg shadow-sm tap-active hover:bg-[#6ec248] transition-colors mobile-btn text-sm">
                                <i data-lucide="message-circle" class="w-4 h-4 inline mr-1"></i>
                                Buy Now
                            </button>
                        </div>
                    </div>
                `).join('');
                
                lucide.createIcons();
            });
        }

        // --- ACTIONS ---
        function openProduct(id) {
            playSound('click');
            const p = products.find(x => x.id === id);
            if(!p) return;

            state.currentItem = p;
            state.tempQty = 1;

            document.getElementById('modal-img').src = p.img;
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-price').innerText = `₹${p.price}`;
            document.getElementById('add-price').innerText = `(₹${p.price})`;
            document.getElementById('modal-desc').innerText = p.desc;
            document.getElementById('modal-harvest').innerText = p.time;
            document.getElementById('qty-display').innerText = "1";
            document.getElementById('modal-rating-text').innerText = p.rating;
            document.getElementById('modal-cat').innerText = p.type.replace('-seeds', '').replace('spice', 'Spice').replace('hybrid', 'Hybrid');
            
            const heartBtn = document.getElementById('modal-heart-btn');
            if(state.wishlist.includes(p.id)) {
                heartBtn.innerHTML = `<i data-lucide="heart" class="w-6 h-6 fill-red-500 text-red-500"></i>`;
                heartBtn.classList.add('bg-red-50', 'border-red-200');
            } else {
                heartBtn.innerHTML = `<i data-lucide="heart" class="w-6 h-6"></i>`;
                heartBtn.classList.remove('bg-red-50', 'border-red-200');
            }

            if(p.originalPrice) {
                document.getElementById('modal-original-price').innerText = `₹${p.originalPrice}`;
                document.getElementById('modal-original-price').classList.remove('hidden');
            } else {
                document.getElementById('modal-original-price').classList.add('hidden');
            }

            const modal = document.getElementById('product-modal');
            modal.classList.add('active');
            lucide.createIcons();
        }

        function closeModal(id) {
            playSound('click');
            const modal = document.getElementById(id);
            modal.classList.remove('active');
            
            const sheet = modal.querySelector('.sheet-content');
            if(sheet && id === 'cart-drawer') {
                sheet.style.transform = 'translateX(100%)';
            }
        }

        function adjustQty(delta) {
            if(state.tempQty + delta >= 1) {
                state.tempQty += delta;
                document.getElementById('qty-display').innerText = state.tempQty;
                document.getElementById('add-price').innerText = `(₹${state.tempQty * state.currentItem.price})`;
                playSound('click');
            }
        }

        function addToCart() {
            if(!state.currentItem) return;
            
            const existing = state.cart.find(i => i.id === state.currentItem.id);
            if(existing) {
                existing.qty += state.tempQty;
            } else {
                state.cart.push({...state.currentItem, qty: state.tempQty});
            }
            
            saveState();
            closeModal('product-modal');
            showToast('Added', `${state.tempQty}x ${state.currentItem.name}`);
            playSound('add');
        }

        function toggleWishlistItem(id) {
            playSound('click');
            const idx = state.wishlist.indexOf(id);
            if(idx > -1) {
                state.wishlist.splice(idx, 1);
                showToast('Removed', 'Item removed from favorites');
            } else {
                state.wishlist.push(id);
                showToast('Saved', 'Item saved to favorites');
                playSound('success');
            }
            saveState();
            
            if(document.getElementById('product-modal').classList.contains('active')) {
                openProduct(id);
            }
            
            const activePill = document.querySelector('.cat-pill.bg-forest');
            const filter = activePill ? activePill.textContent.toLowerCase().includes('all') ? 'all' : 
                          (activePill.textContent.includes('Fruit') ? 'fruit-seeds' : 
                          (activePill.textContent.includes('Veg') ? 'vegetable-seeds' : 
                          (activePill.textContent.includes('Spice') ? 'spice-seeds' : 'hybrid-seeds'))) : 'all';
            renderGrid(filter);
        }

        function openCart() {
            playSound('click');
            const drawer = document.getElementById('cart-drawer');
            const container = document.getElementById('cart-items-container');
            const sheet = drawer.querySelector('.sheet-content');
            
            drawer.classList.add('active');
            setTimeout(() => {
                sheet.style.transform = 'translateX(0)';
            }, 10);

            if(state.cart.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-gray-400">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-300">
                            <i data-lucide="shopping-bag" class="w-8 h-8"></i>
                        </div>
                        <p class="font-bold text-gray-500">Your basket is empty</p>
                        <p class="text-sm mt-1 text-gray-400">Time to add some green friends!</p>
                    </div>
                `;
                document.getElementById('cart-total-price').innerText = '₹0.00';
            } else {
                let total = 0;
                container.innerHTML = state.cart.map((item, idx) => {
                    total += item.price * item.qty;
                    return `
                        <div class="flex gap-3 bg-white p-3 rounded-2xl border border-gray-100 shadow-sm animate-fade-in relative overflow-hidden group">
                            <img src="${item.img}" class="w-20 h-20 rounded-xl object-cover bg-gray-100">
                            <div class="flex-grow flex flex-col justify-between">
                                <div>
                                    <h4 class="font-bold text-forest leading-tight">${item.name}</h4>
                                    <p class="text-sm text-gray-400 mt-0.5">₹${item.price} / pack</p>
                                </div>
                                <div class="flex items-center justify-between mt-2">
                                    <div class="flex items-center bg-gray-50 rounded-lg h-8 border border-gray-100">
                                        <button onclick="updateCartItem(${idx}, -1)" class="w-8 h-full flex items-center justify-center text-forest hover:bg-gray-100 rounded-l-lg mobile-btn"><i data-lucide="minus" class="w-4 h-4"></i></button>
                                        <span class="text-sm font-bold w-8 text-center">${item.qty}</span>
                                        <button onclick="updateCartItem(${idx}, 1)" class="w-8 h-full flex items-center justify-center text-forest hover:bg-gray-100 rounded-r-lg mobile-btn"><i data-lucide="plus" class="w-4 h-4"></i></button>
                                    </div>
                                    <span class="font-bold text-forest">₹${item.price * item.qty}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                document.getElementById('cart-total-price').innerText = `₹${total}`;
            }
            lucide.createIcons();
        }

        function updateCartItem(idx, delta) {
            playSound('click');
            if(state.cart[idx].qty + delta > 0) {
                state.cart[idx].qty += delta;
            } else {
                state.cart.splice(idx, 1);
            }
            saveState();
            openCart();
        }

        // --- WHATSAPP CHECKOUT ---
        function checkoutToWhatsApp() {
            if(state.cart.length === 0) {
                showToast('Empty Cart', 'Add items to cart first');
                return;
            }
            
            const phoneNumber = "9526725376";
            let message = `*New Order from Lightsprouts*\n\n`;
            let total = 0;
            
            state.cart.forEach(i => {
                message += `${i.qty}x ${i.name} - ₹${i.price*i.qty}\n`;
                total += i.price*i.qty;
            });
            
            message += `\n*Total: ₹${total}*\n`;
            
            // Add user details if available
            if (state.userDetails) {
                message += `\n*Customer Details:*\n`;
                message += `Name: ${state.userDetails.firstName} ${state.userDetails.lastName}\n`;
                message += `Phone: ${state.userDetails.phone}\n`;
                message += `Address: ${state.userDetails.address}\n`;
                message += `Email: ${state.userDetails.email}\n`;
            } else {
                message += `\n*Note:* Customer not logged in\n`;
            }
            
            message += `\nOrder ID: LS${Date.now().toString().slice(-6)}`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            
            // Clear cart after order
            state.cart = [];
            saveState();
            closeModal('cart-drawer');
            showToast('Order Sent', 'Redirecting to WhatsApp...');
            playSound('success');
        }

        function directBuy() {
            if(!state.currentItem) return;
            
            const phoneNumber = "9526725376";
            let message = `*Single Item Order from Lightsprouts*\n\n`;
            message += `${state.tempQty}x ${state.currentItem.name} - ₹${state.currentItem.price * state.tempQty}\n`;
            message += `\n*Total: ₹${state.currentItem.price * state.tempQty}*\n`;
            
            if (state.userDetails) {
                message += `\n*Customer Details:*\n`;
                message += `Name: ${state.userDetails.firstName} ${state.userDetails.lastName}\n`;
                message += `Phone: ${state.userDetails.phone}\n`;
                message += `Address: ${state.userDetails.address}\n`;
                message += `Email: ${state.userDetails.email}\n`;
            }
            
            message += `\nOrder ID: LS${Date.now().toString().slice(-6)}`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            closeModal('product-modal');
            showToast('Order Sent', 'Redirecting to WhatsApp...');
            playSound('success');
        }

        function directBuyFromCard(id) {
            const p = products.find(x => x.id === id);
            if(!p) return;
            
            state.currentItem = p;
            state.tempQty = 1;
            directBuy();
        }

        // --- SEARCH ---
        function openSearch() {
            playSound('click');
            document.getElementById('search-modal').classList.add('active');
            setTimeout(() => document.getElementById('search-input').focus(), 100);
        }

        function handleSearch(query) {
            const container = document.getElementById('search-results');
            if(!query) {
                container.innerHTML = '';
                return;
            }
            
            const results = products.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
            
            container.innerHTML = results.map(p => `
                <div onclick="closeModal('search-modal'); openProduct(${p.id})" class="bg-gray-50 rounded-xl p-2 flex items-center gap-3 cursor-pointer active:scale-95 transition-transform hover:bg-gray-100 border border-gray-100 mobile-btn">
                    <img src="${p.img}" class="w-12 h-12 object-cover rounded-lg">
                    <div>
                        <p class="font-bold text-sm text-forest">${p.name}</p>
                        <p class="text-sm text-gray-500">₹${p.price}</p>
                    </div>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto text-gray-300"></i>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- UTILS ---
        function updateBadges() {
            const cartCount = state.cart.reduce((a,b) => a + b.qty, 0);
            
            const cartBadge = document.getElementById('cart-badge');
            cartBadge.innerText = cartCount;
            if(cartCount > 0) {
                cartBadge.classList.remove('opacity-0', 'scale-0');
            } else {
                cartBadge.classList.add('opacity-0', 'scale-0');
            }
        }

        function saveState() {
            localStorage.setItem('ls_cart', JSON.stringify(state.cart));
            localStorage.setItem('ls_wishlist', JSON.stringify(state.wishlist));
            updateBadges();
        }

        function showToast(title, msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-title').innerText = title;
            document.getElementById('toast-message').innerText = msg;
            
            toast.style.transform = 'translateX(0)';
            setTimeout(() => {
                toast.style.transform = 'translateX(150%)';
            }, 3000);
        }

        function scrollToGrid() {
            playSound('click');
            document.getElementById('grid-anchor').scrollIntoView({behavior: 'smooth'});
        }

        function filterProducts(type) {
            playSound('click');
            renderGrid(type);
            scrollToGrid();
        }

        function switchTab(tab) {
            playSound('click');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('text-forest'));
            event.currentTarget.classList.add('text-forest');
            if(tab === 'home') window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // Prevent dragging
        document.addEventListener('dragstart', function(e) {
            if (e.target.tagName === 'IMG') {
                e.preventDefault();
            }
        });

        // Prevent text selection
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
        });

    </script>
</body>
</html>
